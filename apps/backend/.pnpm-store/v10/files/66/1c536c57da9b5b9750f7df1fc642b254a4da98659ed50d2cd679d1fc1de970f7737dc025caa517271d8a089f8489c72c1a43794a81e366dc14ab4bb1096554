{"version":3,"file":"index.js","names":["dequal","useRouter","serialize","deepCopyObjectSimpleWithoutReactComponents","getDataByPath","getDataByPathFunc","getSiblingData","getSiblingDataFunc","reduceFieldsToValues","wait","React","useCallback","useEffect","useReducer","useRef","useState","toast","FieldErrorsToast","useDebouncedEffect","useEffectEvent","useQueues","useThrottledEffect","useAuth","useConfig","useDocumentInfo","useLocale","useOperation","useRouteTransition","useServerFunctions","useTranslation","useUploadHandlers","abortAndIgnore","handleAbortRef","requests","BackgroundProcessingContext","DocumentFormContext","FormContext","FormFieldsContext","FormWatchContext","InitializingContext","ModifiedContext","ProcessingContext","SubmittedContext","useDocumentForm","errorMessages","fieldReducer","initContextState","baseClass","Form","props","id","collectionSlug","docConfig","docPermissions","getDocPreferences","globalSlug","action","beforeSubmit","children","className","disabled","disabledFromProps","disableSuccessStatus","disableValidationOnSubmit","el","handleResponse","initialState","isDocumentForm","isInitializing","initializingFromProps","onChange","onSubmit","onSuccess","redirect","submitted","submittedFromProps","uuid","waitForAutocomplete","method","undefined","router","documentForm","code","locale","i18n","t","refreshCookie","user","operation","queueTask","getFormState","startRouteTransition","getUploadHandler","config","setDisabled","isMounted","setIsMounted","modified","setModified","isValid","setIsValid","initializing","setInitializing","processing","setProcessing","backgroundProcessing","setBackgroundProcessing","setSubmitted","formRef","contextRef","abortResetFormRef","isFirstRenderRef","fieldsReducer","formState","dispatchFields","current","fields","prevFormState","validateForm","validatedFieldState","data","getData","validationPromises","Object","entries","map","path","field","validatedField","pathSegments","split","passesCondition","validationResult","valid","validate","valueToValidate","value","rows","Array","isArray","blockData","event","preferences","req","payload","siblingData","errorMessage","Promise","all","type","state","submit","options","e","actionArg","methodToUse","overrides","overridesFromArgs","skipValidation","preventDefault","errorToast","successToast","promise","resolve","reject","hasFormSubmitAction","success","error","loading","stopPropagation","revalidatedFormState","serializableFields","reduce","priorOnChange","beforeSubmitFn","result","every","key","formData","createFormData","mergeOverrideData","Boolean","res","toLowerCase","body","headers","language","contentType","get","isJSON","indexOf","json","status","newFormState","acceptValues","prevStateRef","serverState","push","message","errors","fieldErrors","nonFieldErrors","fieldErrs","nonFieldErrs","err","newFieldErrs","newNonFieldErrs","forEach","dataError","_jsx","statusText","console","getFields","getField","file","upload","handler","filename","name","clientUploadContext","updateFilename","JSON","stringify","mimeType","size","dataToSerialize","_payload","indices","nullsAsUndefineds","reset","controller","docPreferences","newState","renderAllFields","schemaPath","signal","replaceState","addFieldRow","blockType","rowIndex","rowIndexArg","subFieldState","newRows","length","moveFieldRow","moveFromIndex","moveToIndex","removeFieldRow","replaceFieldRow","currentRows","abortOnChange","optimize","sanitize","classes","filter","join","executeOnChange","onChangeFn","DocumentFormContextComponent","Fragment","documentFormContextProps","El","noValidate","ref","Provider","useAllFormFields","useForm","useFormFields","useFormModified","useFormProcessing","useFormSubmitted","useWatchForm"],"sources":["../../../src/forms/Form/index.tsx"],"sourcesContent":["'use client'\nimport { dequal } from 'dequal/lite' // lite: no need for Map and Set support\nimport { useRouter } from 'next/navigation.js'\nimport { serialize } from 'object-to-formdata'\nimport { type FormState, type PayloadRequest } from 'payload'\nimport {\n  deepCopyObjectSimpleWithoutReactComponents,\n  getDataByPath as getDataByPathFunc,\n  getSiblingData as getSiblingDataFunc,\n  reduceFieldsToValues,\n  wait,\n} from 'payload/shared'\nimport React, { useCallback, useEffect, useReducer, useRef, useState } from 'react'\nimport { toast } from 'sonner'\n\nimport type {\n  CreateFormData,\n  Context as FormContextType,\n  FormProps,\n  GetDataByPath,\n  SubmitOptions,\n} from './types.js'\n\nimport { FieldErrorsToast } from '../../elements/Toasts/fieldErrors.js'\nimport { useDebouncedEffect } from '../../hooks/useDebouncedEffect.js'\nimport { useEffectEvent } from '../../hooks/useEffectEvent.js'\nimport { useQueues } from '../../hooks/useQueues.js'\nimport { useThrottledEffect } from '../../hooks/useThrottledEffect.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { useDocumentInfo } from '../../providers/DocumentInfo/index.js'\nimport { useLocale } from '../../providers/Locale/index.js'\nimport { useOperation } from '../../providers/Operation/index.js'\nimport { useRouteTransition } from '../../providers/RouteTransition/index.js'\nimport { useServerFunctions } from '../../providers/ServerFunctions/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { useUploadHandlers } from '../../providers/UploadHandlers/index.js'\nimport { abortAndIgnore, handleAbortRef } from '../../utilities/abortAndIgnore.js'\nimport { requests } from '../../utilities/api.js'\nimport {\n  BackgroundProcessingContext,\n  DocumentFormContext,\n  FormContext,\n  FormFieldsContext,\n  FormWatchContext,\n  InitializingContext,\n  ModifiedContext,\n  ProcessingContext,\n  SubmittedContext,\n  useDocumentForm,\n} from './context.js'\nimport { errorMessages } from './errorMessages.js'\nimport { fieldReducer } from './fieldReducer.js'\nimport { initContextState } from './initContextState.js'\n\nconst baseClass = 'form'\n\nexport const Form: React.FC<FormProps> = (props) => {\n  const { id, collectionSlug, docConfig, docPermissions, getDocPreferences, globalSlug } =\n    useDocumentInfo()\n\n  const {\n    action,\n    beforeSubmit,\n    children,\n    className,\n    disabled: disabledFromProps,\n    disableSuccessStatus,\n    disableValidationOnSubmit,\n    // fields: fieldsFromProps = collection?.fields || global?.fields,\n    el,\n    handleResponse,\n    initialState, // fully formed initial field state\n    isDocumentForm,\n    isInitializing: initializingFromProps,\n    onChange,\n    onSubmit,\n    onSuccess,\n    redirect,\n    submitted: submittedFromProps,\n    uuid,\n    waitForAutocomplete,\n  } = props\n\n  const method = 'method' in props ? props?.method : undefined\n\n  const router = useRouter()\n\n  const documentForm = useDocumentForm()\n\n  const { code: locale } = useLocale()\n  const { i18n, t } = useTranslation()\n  const { refreshCookie, user } = useAuth()\n  const operation = useOperation()\n  const { queueTask } = useQueues()\n\n  const { getFormState } = useServerFunctions()\n  const { startRouteTransition } = useRouteTransition()\n  const { getUploadHandler } = useUploadHandlers()\n\n  const { config } = useConfig()\n\n  const [disabled, setDisabled] = useState(disabledFromProps || false)\n  const [isMounted, setIsMounted] = useState(false)\n  const [modified, setModified] = useState(false)\n\n  /**\n   * Tracks wether the form state passes validation.\n   * For example the state could be submitted but invalid as field errors have been returned.\n   */\n  const [isValid, setIsValid] = useState(true)\n  const [initializing, setInitializing] = useState(initializingFromProps)\n\n  const [processing, setProcessing] = useState(false)\n  const [backgroundProcessing, setBackgroundProcessing] = useState(false)\n\n  const [submitted, setSubmitted] = useState(false)\n  const formRef = useRef<HTMLFormElement>(null)\n  const contextRef = useRef({} as FormContextType)\n  const abortResetFormRef = useRef<AbortController>(null)\n  const isFirstRenderRef = useRef(true)\n\n  const fieldsReducer = useReducer(fieldReducer, {}, () => initialState)\n\n  const [formState, dispatchFields] = fieldsReducer\n\n  contextRef.current.fields = formState\n\n  const prevFormState = useRef(formState)\n\n  const validateForm = useCallback(async () => {\n    const validatedFieldState = {}\n    let isValid = true\n\n    const data = contextRef.current.getData()\n\n    const validationPromises = Object.entries(contextRef.current.fields).map(\n      async ([path, field]) => {\n        const validatedField = field\n        const pathSegments = path ? path.split('.') : []\n\n        if (field.passesCondition !== false) {\n          let validationResult: boolean | string = validatedField.valid\n\n          if ('validate' in field && typeof field.validate === 'function') {\n            let valueToValidate = field.value\n\n            if (field?.rows && Array.isArray(field.rows)) {\n              valueToValidate = contextRef.current.getDataByPath(path)\n            }\n\n            validationResult = await field.validate(valueToValidate, {\n              ...field,\n              id,\n              collectionSlug,\n              // If there is a parent document form, we can get the data from that form\n              blockData: undefined, // Will be expensive to get - not worth to pass to client-side validation, as this can be obtained by the user using `useFormFields()`\n              data: documentForm?.getData ? documentForm.getData() : data,\n              event: 'submit',\n              operation,\n              path: pathSegments,\n              preferences: {} as any,\n              req: {\n                payload: {\n                  config,\n                },\n                t,\n                user,\n              } as unknown as PayloadRequest,\n              siblingData: contextRef.current.getSiblingData(path),\n            })\n\n            if (typeof validationResult === 'string') {\n              validatedField.errorMessage = validationResult\n              validatedField.valid = false\n            } else {\n              validatedField.valid = true\n              validatedField.errorMessage = undefined\n            }\n          }\n\n          if (validatedField.valid === false) {\n            isValid = false\n          }\n        }\n\n        validatedFieldState[path] = validatedField\n      },\n    )\n\n    await Promise.all(validationPromises)\n\n    if (!dequal(contextRef.current.fields, validatedFieldState)) {\n      dispatchFields({ type: 'REPLACE_STATE', state: validatedFieldState })\n    }\n\n    setIsValid(isValid)\n\n    return isValid\n  }, [collectionSlug, config, dispatchFields, id, operation, t, user, documentForm])\n\n  const submit = useCallback(\n    async (options: SubmitOptions = {}, e): Promise<void> => {\n      const {\n        action: actionArg = action,\n        method: methodToUse = method,\n        overrides: overridesFromArgs = {},\n        skipValidation,\n      } = options\n\n      if (disabled) {\n        if (e) {\n          e.preventDefault()\n        }\n        return\n      }\n\n      // create new toast promise which will resolve manually later\n      let errorToast, successToast\n      const promise = new Promise((resolve, reject) => {\n        successToast = resolve\n        errorToast = reject\n      })\n\n      const hasFormSubmitAction =\n        actionArg || typeof action === 'string' || typeof action === 'function'\n\n      if (redirect || disableSuccessStatus || !hasFormSubmitAction) {\n        // Do not show submitting toast, as the promise toast may never disappear under these conditions.\n        // Instead, make successToast() or errorToast() throw toast.success / toast.error\n        successToast = (data) => toast.success(data)\n        errorToast = (data) => toast.error(data)\n      } else {\n        toast.promise(promise, {\n          error: (data) => {\n            return data as string\n          },\n          loading: t('general:submitting'),\n          success: (data) => {\n            return data as string\n          },\n        })\n      }\n\n      if (e) {\n        e.stopPropagation()\n        e.preventDefault()\n      }\n\n      setProcessing(true)\n      setDisabled(true)\n\n      if (waitForAutocomplete) {\n        await wait(100)\n      }\n\n      // Execute server side validations\n      if (Array.isArray(beforeSubmit)) {\n        let revalidatedFormState: FormState\n\n        const serializableFields = deepCopyObjectSimpleWithoutReactComponents(\n          contextRef.current.fields,\n        )\n\n        await beforeSubmit.reduce(async (priorOnChange, beforeSubmitFn) => {\n          await priorOnChange\n\n          const result = await beforeSubmitFn({\n            formState: serializableFields,\n          })\n\n          revalidatedFormState = result\n        }, Promise.resolve())\n\n        const isValid = Object.entries(revalidatedFormState).every(\n          ([, field]) => field.valid !== false,\n        )\n\n        setIsValid(isValid)\n\n        if (!isValid) {\n          setProcessing(false)\n          setSubmitted(true)\n          setDisabled(false)\n          return dispatchFields({ type: 'REPLACE_STATE', state: revalidatedFormState })\n        }\n      }\n\n      const isValid =\n        skipValidation || disableValidationOnSubmit ? true : await contextRef.current.validateForm()\n\n      setIsValid(isValid)\n      // If not valid, prevent submission\n      if (!isValid) {\n        errorToast(t('error:correctInvalidFields'))\n        setProcessing(false)\n        setSubmitted(true)\n        setDisabled(false)\n        return\n      }\n\n      let overrides = {}\n\n      if (typeof overridesFromArgs === 'function') {\n        overrides = overridesFromArgs(contextRef.current.fields)\n      } else if (typeof overridesFromArgs === 'object') {\n        overrides = overridesFromArgs\n      }\n\n      // If submit handler comes through via props, run that\n      if (onSubmit) {\n        const serializableFields = deepCopyObjectSimpleWithoutReactComponents(\n          contextRef.current.fields,\n        )\n\n        const data = reduceFieldsToValues(serializableFields, true)\n\n        for (const [key, value] of Object.entries(overrides)) {\n          data[key] = value\n        }\n\n        onSubmit(serializableFields, data)\n      }\n\n      if (!hasFormSubmitAction) {\n        // No action provided, so we should return. An example where this happens are lexical link drawers. Upon submitting the drawer, we\n        // want to close it without submitting the form. Stuff like validation would be handled by lexical before this, through beforeSubmit\n        setProcessing(false)\n        setSubmitted(true)\n        setDisabled(false)\n        return\n      }\n\n      const formData = await contextRef.current.createFormData(overrides, {\n        mergeOverrideData: Boolean(typeof overridesFromArgs !== 'function'),\n      })\n\n      try {\n        let res\n\n        if (typeof actionArg === 'string') {\n          res = await requests[methodToUse.toLowerCase()](actionArg, {\n            body: formData,\n            headers: {\n              'Accept-Language': i18n.language,\n            },\n          })\n        } else if (typeof action === 'function') {\n          res = await action(formData)\n        }\n\n        setModified(false)\n        setDisabled(false)\n\n        if (typeof handleResponse === 'function') {\n          handleResponse(res, successToast, errorToast)\n          return\n        }\n\n        const contentType = res.headers.get('content-type')\n        const isJSON = contentType && contentType.indexOf('application/json') !== -1\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        let json: Record<string, any> = {}\n\n        if (isJSON) {\n          json = await res.json()\n        }\n        if (res.status < 400) {\n          if (typeof onSuccess === 'function') {\n            const newFormState = await onSuccess(json)\n\n            if (newFormState) {\n              dispatchFields({\n                type: 'MERGE_SERVER_STATE',\n                acceptValues: true,\n                prevStateRef: prevFormState,\n                serverState: newFormState,\n              })\n            }\n          }\n          setSubmitted(false)\n          setProcessing(false)\n\n          if (redirect) {\n            startRouteTransition(() => router.push(redirect))\n          } else if (!disableSuccessStatus) {\n            successToast(json.message || t('general:submissionSuccessful'))\n          }\n        } else {\n          setProcessing(false)\n          setSubmitted(true)\n\n          contextRef.current = { ...contextRef.current } // triggers rerender of all components that subscribe to form\n          if (json.message) {\n            errorToast(json.message)\n            return\n          }\n\n          if (Array.isArray(json.errors)) {\n            const [fieldErrors, nonFieldErrors] = json.errors.reduce(\n              ([fieldErrs, nonFieldErrs], err) => {\n                const newFieldErrs = []\n                const newNonFieldErrs = []\n\n                if (err?.message) {\n                  newNonFieldErrs.push(err)\n                }\n\n                if (Array.isArray(err?.data?.errors)) {\n                  err.data?.errors.forEach((dataError) => {\n                    if (dataError?.path) {\n                      newFieldErrs.push(dataError)\n                    } else {\n                      newNonFieldErrs.push(dataError)\n                    }\n                  })\n                }\n\n                return [\n                  [...fieldErrs, ...newFieldErrs],\n                  [...nonFieldErrs, ...newNonFieldErrs],\n                ]\n              },\n              [[], []],\n            )\n\n            setIsValid(false)\n\n            dispatchFields({\n              type: 'ADD_SERVER_ERRORS',\n              errors: fieldErrors,\n            })\n\n            nonFieldErrors.forEach((err) => {\n              errorToast(<FieldErrorsToast errorMessage={err.message || t('error:unknown')} />)\n            })\n\n            return\n          }\n\n          const message = errorMessages?.[res.status] || res?.statusText || t('error:unknown')\n\n          errorToast(message)\n        }\n      } catch (err) {\n        console.error('Error submitting form', err) // eslint-disable-line no-console\n        setProcessing(false)\n        setSubmitted(true)\n        setDisabled(false)\n        errorToast(err.message)\n      }\n    },\n    [\n      beforeSubmit,\n      startRouteTransition,\n      action,\n      disableSuccessStatus,\n      disableValidationOnSubmit,\n      disabled,\n      dispatchFields,\n      handleResponse,\n      method,\n      onSubmit,\n      onSuccess,\n      redirect,\n      router,\n      t,\n      i18n,\n      waitForAutocomplete,\n    ],\n  )\n\n  const getFields = useCallback(() => contextRef.current.fields, [])\n\n  const getField = useCallback((path: string) => contextRef.current.fields[path], [])\n\n  const getData = useCallback(() => reduceFieldsToValues(contextRef.current.fields, true), [])\n\n  const getSiblingData = useCallback(\n    (path: string) => getSiblingDataFunc(contextRef.current.fields, path),\n    [],\n  )\n\n  const getDataByPath = useCallback<GetDataByPath>(\n    (path: string) => getDataByPathFunc(contextRef.current.fields, path),\n    [],\n  )\n\n  const createFormData = useCallback<CreateFormData>(\n    async (overrides, { mergeOverrideData = true }) => {\n      let data = reduceFieldsToValues(contextRef.current.fields, true)\n\n      let file = data?.file\n\n      if (docConfig && 'upload' in docConfig && docConfig.upload && file) {\n        delete data.file\n\n        const handler = getUploadHandler({ collectionSlug })\n\n        if (typeof handler === 'function') {\n          let filename = file.name\n          const clientUploadContext = await handler({\n            file,\n            updateFilename: (value) => {\n              filename = value\n            },\n          })\n\n          file = JSON.stringify({\n            clientUploadContext,\n            collectionSlug,\n            filename,\n            mimeType: file.type,\n            size: file.size,\n          })\n        }\n      }\n\n      if (mergeOverrideData) {\n        data = {\n          ...data,\n          ...overrides,\n        }\n      } else {\n        data = overrides\n      }\n\n      const dataToSerialize: Record<string, unknown> = {\n        _payload: JSON.stringify(data),\n      }\n\n      if (docConfig && 'upload' in docConfig && docConfig.upload && file) {\n        dataToSerialize.file = file\n      }\n\n      // nullAsUndefineds is important to allow uploads and relationship fields to clear themselves\n      const formData = serialize(dataToSerialize, {\n        indices: true,\n        nullsAsUndefineds: false,\n      })\n\n      return formData\n    },\n    [collectionSlug, docConfig, getUploadHandler],\n  )\n\n  const reset = useCallback(\n    async (data: unknown) => {\n      const controller = handleAbortRef(abortResetFormRef)\n\n      const docPreferences = await getDocPreferences()\n\n      const { state: newState } = await getFormState({\n        id,\n        collectionSlug,\n        data,\n        docPermissions,\n        docPreferences,\n        globalSlug,\n        locale,\n        operation,\n        renderAllFields: true,\n        schemaPath: collectionSlug ? collectionSlug : globalSlug,\n        signal: controller.signal,\n        skipValidation: true,\n      })\n\n      contextRef.current = { ...initContextState } as FormContextType\n      setModified(false)\n      dispatchFields({ type: 'REPLACE_STATE', state: newState })\n\n      abortResetFormRef.current = null\n    },\n    [\n      collectionSlug,\n      dispatchFields,\n      globalSlug,\n      id,\n      operation,\n      getFormState,\n      docPermissions,\n      getDocPreferences,\n      locale,\n    ],\n  )\n\n  const replaceState = useCallback(\n    (state: FormState) => {\n      contextRef.current = { ...initContextState } as FormContextType\n      setModified(false)\n      dispatchFields({ type: 'REPLACE_STATE', state })\n    },\n    [dispatchFields],\n  )\n\n  const addFieldRow: FormContextType['addFieldRow'] = useCallback(\n    ({ blockType, path, rowIndex: rowIndexArg, subFieldState }) => {\n      const newRows: unknown[] = getDataByPath(path) || []\n      const rowIndex = rowIndexArg === undefined ? newRows.length : rowIndexArg\n\n      // dispatch ADD_ROW adds a blank row to local form state.\n      // This performs no form state request, as the debounced onChange effect will do that for us.\n      dispatchFields({\n        type: 'ADD_ROW',\n        blockType,\n        path,\n        rowIndex,\n        subFieldState,\n      })\n\n      setModified(true)\n    },\n    [dispatchFields, getDataByPath],\n  )\n\n  const moveFieldRow: FormContextType['moveFieldRow'] = useCallback(\n    ({ moveFromIndex, moveToIndex, path }) => {\n      dispatchFields({\n        type: 'MOVE_ROW',\n        moveFromIndex,\n        moveToIndex,\n        path,\n      })\n\n      setModified(true)\n    },\n    [dispatchFields],\n  )\n\n  const removeFieldRow: FormContextType['removeFieldRow'] = useCallback(\n    ({ path, rowIndex }) => {\n      dispatchFields({ type: 'REMOVE_ROW', path, rowIndex })\n\n      setModified(true)\n    },\n    [dispatchFields],\n  )\n\n  const replaceFieldRow: FormContextType['replaceFieldRow'] = useCallback(\n    ({ blockType, path, rowIndex: rowIndexArg, subFieldState }) => {\n      const currentRows: unknown[] = getDataByPath(path)\n      const rowIndex = rowIndexArg === undefined ? currentRows.length : rowIndexArg\n\n      dispatchFields({\n        type: 'REPLACE_ROW',\n        blockType,\n        path,\n        rowIndex,\n        subFieldState,\n      })\n\n      setModified(true)\n    },\n    [dispatchFields, getDataByPath],\n  )\n\n  useEffect(() => {\n    const abortOnChange = abortResetFormRef.current\n\n    return () => {\n      abortAndIgnore(abortOnChange)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (initializingFromProps !== undefined) {\n      setInitializing(initializingFromProps)\n    }\n  }, [initializingFromProps])\n\n  contextRef.current.submit = submit\n  contextRef.current.getFields = getFields\n  contextRef.current.getField = getField\n  contextRef.current.getData = getData\n  contextRef.current.getSiblingData = getSiblingData\n  contextRef.current.getDataByPath = getDataByPath\n  contextRef.current.validateForm = validateForm\n  contextRef.current.createFormData = createFormData\n  contextRef.current.setModified = setModified\n  contextRef.current.setProcessing = setProcessing\n  contextRef.current.setBackgroundProcessing = setBackgroundProcessing\n\n  contextRef.current.setSubmitted = setSubmitted\n  contextRef.current.setIsValid = setIsValid\n  contextRef.current.disabled = disabled\n  contextRef.current.setDisabled = setDisabled\n  contextRef.current.formRef = formRef\n  contextRef.current.reset = reset\n  contextRef.current.replaceState = replaceState\n  contextRef.current.dispatchFields = dispatchFields\n  contextRef.current.addFieldRow = addFieldRow\n  contextRef.current.removeFieldRow = removeFieldRow\n  contextRef.current.moveFieldRow = moveFieldRow\n  contextRef.current.replaceFieldRow = replaceFieldRow\n  contextRef.current.uuid = uuid\n  contextRef.current.initializing = initializing\n  contextRef.current.isValid = isValid\n\n  useEffect(() => {\n    setIsMounted(true)\n  }, [])\n\n  useEffect(() => {\n    if (typeof disabledFromProps === 'boolean') {\n      setDisabled(disabledFromProps)\n    }\n  }, [disabledFromProps])\n\n  useEffect(() => {\n    if (typeof submittedFromProps === 'boolean') {\n      setSubmitted(submittedFromProps)\n    }\n  }, [submittedFromProps])\n\n  useEffect(() => {\n    if (initialState) {\n      contextRef.current = { ...initContextState } as FormContextType\n      dispatchFields({\n        type: 'REPLACE_STATE',\n        optimize: false,\n        sanitize: true,\n        state: initialState,\n      })\n    }\n  }, [initialState, dispatchFields])\n\n  useThrottledEffect(\n    () => {\n      refreshCookie()\n    },\n    15000,\n    [formState],\n  )\n\n  useEffect(() => {\n    contextRef.current = { ...contextRef.current } // triggers rerender of all components that subscribe to form\n    setModified(false)\n  }, [locale])\n\n  const classes = [className, baseClass].filter(Boolean).join(' ')\n\n  const executeOnChange = useEffectEvent((submitted: boolean) => {\n    queueTask(async () => {\n      if (Array.isArray(onChange)) {\n        let serverState: FormState\n\n        for (const onChangeFn of onChange) {\n          // Edit view default onChange is in packages/ui/src/views/Edit/index.tsx. This onChange usually sends a form state request\n          serverState = await onChangeFn({\n            formState: deepCopyObjectSimpleWithoutReactComponents(formState),\n            submitted,\n          })\n        }\n\n        dispatchFields({\n          type: 'MERGE_SERVER_STATE',\n          prevStateRef: prevFormState,\n          serverState,\n        })\n      }\n    })\n  })\n\n  useDebouncedEffect(\n    () => {\n      if ((isFirstRenderRef.current || !dequal(formState, prevFormState.current)) && modified) {\n        executeOnChange(submitted)\n      }\n\n      prevFormState.current = formState\n      isFirstRenderRef.current = false\n    },\n    [modified, submitted, formState],\n    250,\n  )\n\n  const DocumentFormContextComponent: React.FC<any> = isDocumentForm\n    ? DocumentFormContext\n    : React.Fragment\n\n  const documentFormContextProps = isDocumentForm\n    ? {\n        value: contextRef.current,\n      }\n    : {}\n\n  const El: 'form' = (el as unknown as 'form') || 'form'\n\n  return (\n    <El\n      action={typeof action === 'function' ? void action : action}\n      className={classes}\n      method={method}\n      noValidate\n      onSubmit={(e) => void contextRef.current.submit({}, e)}\n      ref={formRef}\n    >\n      <DocumentFormContextComponent {...documentFormContextProps}>\n        <FormContext value={contextRef.current}>\n          <FormWatchContext\n            value={{\n              fields: formState,\n              ...contextRef.current,\n            }}\n          >\n            <SubmittedContext value={submitted}>\n              <InitializingContext value={!isMounted || (isMounted && initializing)}>\n                <ProcessingContext value={processing}>\n                  <BackgroundProcessingContext value={backgroundProcessing}>\n                    <ModifiedContext value={modified}>\n                      {/* eslint-disable-next-line @eslint-react/no-context-provider */}\n                      <FormFieldsContext.Provider value={fieldsReducer}>\n                        {children}\n                      </FormFieldsContext.Provider>\n                    </ModifiedContext>\n                  </BackgroundProcessingContext>\n                </ProcessingContext>\n              </InitializingContext>\n            </SubmittedContext>\n          </FormWatchContext>\n        </FormContext>\n      </DocumentFormContextComponent>\n    </El>\n  )\n}\n\nexport {\n  DocumentFormContext,\n  FormContext,\n  FormFieldsContext,\n  FormWatchContext,\n  ModifiedContext,\n  ProcessingContext,\n  SubmittedContext,\n  useAllFormFields,\n  useDocumentForm,\n  useForm,\n  useFormFields,\n  useFormModified,\n  useFormProcessing,\n  useFormSubmitted,\n  useWatchForm,\n} from './context.js'\n\nexport { FormProps }\n"],"mappings":"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","ignoreList":[]}