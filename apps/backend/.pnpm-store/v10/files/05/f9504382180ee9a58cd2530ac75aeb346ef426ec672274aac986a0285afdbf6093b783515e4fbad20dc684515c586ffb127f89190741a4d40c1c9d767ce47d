{"version":3,"sources":["../src/updateOne.ts"],"sourcesContent":["import type { MongooseUpdateQueryOptions } from 'mongoose'\nimport type { UpdateOne } from 'payload'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { buildQuery } from './queries/buildQuery.js'\nimport { buildProjectionFromSelect } from './utilities/buildProjectionFromSelect.js'\nimport { getCollection } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { handleError } from './utilities/handleError.js'\nimport { transform } from './utilities/transform.js'\n\nexport const updateOne: UpdateOne = async function updateOne(\n  this: MongooseAdapter,\n  {\n    id,\n    collection: collectionSlug,\n    data,\n    locale,\n    options: optionsArgs = {},\n    req,\n    returning,\n    select,\n    where: whereArg = {},\n  },\n) {\n  const { collectionConfig, Model } = getCollection({ adapter: this, collectionSlug })\n  const where = id ? { id: { equals: id } } : whereArg\n  const fields = collectionConfig.fields\n\n  const options: MongooseUpdateQueryOptions = {\n    ...optionsArgs,\n    lean: true,\n    new: true,\n    projection: buildProjectionFromSelect({\n      adapter: this,\n      fields: collectionConfig.flattenedFields,\n      select,\n    }),\n    session: await getSession(this, req),\n  }\n\n  const query = await buildQuery({\n    adapter: this,\n    collectionSlug,\n    fields: collectionConfig.flattenedFields,\n    locale,\n    where,\n  })\n\n  let result\n\n  transform({ adapter: this, data, fields, operation: 'write' })\n\n  try {\n    if (returning === false) {\n      await Model.updateOne(query, data, options)\n      transform({ adapter: this, data, fields, operation: 'read' })\n      return null\n    } else {\n      result = await Model.findOneAndUpdate(query, data, options)\n    }\n  } catch (error) {\n    handleError({ collection: collectionSlug, error, req })\n  }\n\n  if (!result) {\n    return null\n  }\n\n  transform({ adapter: this, data: result, fields, operation: 'read' })\n\n  return result\n}\n"],"names":["buildQuery","buildProjectionFromSelect","getCollection","getSession","handleError","transform","updateOne","id","collection","collectionSlug","data","locale","options","optionsArgs","req","returning","select","where","whereArg","collectionConfig","Model","adapter","equals","fields","lean","new","projection","flattenedFields","session","query","result","operation","findOneAndUpdate","error"],"mappings":"AAKA,SAASA,UAAU,QAAQ,0BAAyB;AACpD,SAASC,yBAAyB,QAAQ,2CAA0C;AACpF,SAASC,aAAa,QAAQ,2BAA0B;AACxD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,WAAW,QAAQ,6BAA4B;AACxD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,YAAuB,eAAeA,UAEjD,EACEC,EAAE,EACFC,YAAYC,cAAc,EAC1BC,IAAI,EACJC,MAAM,EACNC,SAASC,cAAc,CAAC,CAAC,EACzBC,GAAG,EACHC,SAAS,EACTC,MAAM,EACNC,OAAOC,WAAW,CAAC,CAAC,EACrB;IAED,MAAM,EAAEC,gBAAgB,EAAEC,KAAK,EAAE,GAAGlB,cAAc;QAAEmB,SAAS,IAAI;QAAEZ;IAAe;IAClF,MAAMQ,QAAQV,KAAK;QAAEA,IAAI;YAAEe,QAAQf;QAAG;IAAE,IAAIW;IAC5C,MAAMK,SAASJ,iBAAiBI,MAAM;IAEtC,MAAMX,UAAsC;QAC1C,GAAGC,WAAW;QACdW,MAAM;QACNC,KAAK;QACLC,YAAYzB,0BAA0B;YACpCoB,SAAS,IAAI;YACbE,QAAQJ,iBAAiBQ,eAAe;YACxCX;QACF;QACAY,SAAS,MAAMzB,WAAW,IAAI,EAAEW;IAClC;IAEA,MAAMe,QAAQ,MAAM7B,WAAW;QAC7BqB,SAAS,IAAI;QACbZ;QACAc,QAAQJ,iBAAiBQ,eAAe;QACxChB;QACAM;IACF;IAEA,IAAIa;IAEJzB,UAAU;QAAEgB,SAAS,IAAI;QAAEX;QAAMa;QAAQQ,WAAW;IAAQ;IAE5D,IAAI;QACF,IAAIhB,cAAc,OAAO;YACvB,MAAMK,MAAMd,SAAS,CAACuB,OAAOnB,MAAME;YACnCP,UAAU;gBAAEgB,SAAS,IAAI;gBAAEX;gBAAMa;gBAAQQ,WAAW;YAAO;YAC3D,OAAO;QACT,OAAO;YACLD,SAAS,MAAMV,MAAMY,gBAAgB,CAACH,OAAOnB,MAAME;QACrD;IACF,EAAE,OAAOqB,OAAO;QACd7B,YAAY;YAAEI,YAAYC;YAAgBwB;YAAOnB;QAAI;IACvD;IAEA,IAAI,CAACgB,QAAQ;QACX,OAAO;IACT;IAEAzB,UAAU;QAAEgB,SAAS,IAAI;QAAEX,MAAMoB;QAAQP;QAAQQ,WAAW;IAAO;IAEnE,OAAOD;AACT,EAAC"}