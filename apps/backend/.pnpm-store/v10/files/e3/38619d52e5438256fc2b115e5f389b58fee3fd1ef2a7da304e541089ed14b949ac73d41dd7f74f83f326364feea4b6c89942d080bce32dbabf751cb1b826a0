{
  "version": 3,
  "sources": ["../../../src/features/relationship/client/components/RelationshipComponent.tsx"],
  "sourcesContent": ["'use client'\nimport type { ElementFormatType } from 'lexical'\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext.js'\nimport { getTranslation } from '@payloadcms/translations'\nimport { Button, useConfig, usePayloadAPI, useTranslation } from '@payloadcms/ui'\nimport { $getNodeByKey } from 'lexical'\nimport React, { useCallback, useReducer, useRef, useState } from 'react'\n\nimport type { RelationshipData } from '../../server/nodes/RelationshipNode.js'\n\nimport { useEditorConfigContext } from '../../../../lexical/config/client/EditorConfigProvider.js'\nimport { useLexicalDocumentDrawer } from '../../../../utilities/fieldsDrawer/useLexicalDocumentDrawer.js'\nimport { INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND } from '../drawer/commands.js'\nimport './index.scss'\n\nconst baseClass = 'lexical-relationship'\n\nconst initialParams = {\n  depth: 0,\n}\n\ntype Props = {\n  className?: string\n  data: RelationshipData\n  format?: ElementFormatType\n  nodeKey?: string\n}\n\nconst Component: React.FC<Props> = (props) => {\n  const {\n    data: { relationTo, value },\n    nodeKey,\n  } = props\n\n  if (typeof value === 'object') {\n    throw new Error(\n      'Relationship value should be a string or number. The Lexical Relationship component should not receive the populated value object.',\n    )\n  }\n\n  const relationshipElemRef = useRef<HTMLDivElement | null>(null)\n\n  const [editor] = useLexicalComposerContext()\n  const {\n    fieldProps: { readOnly },\n  } = useEditorConfigContext()\n  const {\n    config: {\n      routes: { api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const [relatedCollection] = useState(() => getEntityConfig({ collectionSlug: relationTo }))\n\n  const { i18n, t } = useTranslation()\n  const [cacheBust, dispatchCacheBust] = useReducer((state) => state + 1, 0)\n  const [{ data }, { setParams }] = usePayloadAPI(\n    `${serverURL}${api}/${relatedCollection.slug}/${value}`,\n    { initialParams },\n  )\n\n  const { closeDocumentDrawer, DocumentDrawer, DocumentDrawerToggler } = useLexicalDocumentDrawer({\n    id: value,\n    collectionSlug: relatedCollection.slug,\n  })\n\n  const removeRelationship = useCallback(() => {\n    editor.update(() => {\n      $getNodeByKey(nodeKey!)?.remove()\n    })\n  }, [editor, nodeKey])\n\n  const updateRelationship = React.useCallback(() => {\n    setParams({\n      ...initialParams,\n      cacheBust, // do this to get the usePayloadAPI to re-fetch the data even though the URL string hasn't changed\n    })\n\n    closeDocumentDrawer()\n    dispatchCacheBust()\n  }, [cacheBust, setParams, closeDocumentDrawer])\n\n  return (\n    <div className={baseClass} contentEditable={false} ref={relationshipElemRef}>\n      <div className={`${baseClass}__wrap`}>\n        <p className={`${baseClass}__label`}>\n          {t('fields:labelRelationship', {\n            label: relatedCollection.labels?.singular\n              ? getTranslation(relatedCollection.labels?.singular, i18n)\n              : relatedCollection.slug,\n          })}\n        </p>\n        <DocumentDrawerToggler className={`${baseClass}__doc-drawer-toggler`}>\n          <p className={`${baseClass}__title`}>\n            {data ? data[relatedCollection?.admin?.useAsTitle || 'id'] : value}\n          </p>\n        </DocumentDrawerToggler>\n      </div>\n      {editor.isEditable() && (\n        <div className={`${baseClass}__actions`}>\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__swapButton`}\n            disabled={readOnly}\n            el=\"button\"\n            icon=\"swap\"\n            onClick={() => {\n              if (nodeKey) {\n                editor.dispatchCommand(INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND, {\n                  replace: { nodeKey },\n                })\n              }\n            }}\n            round\n            tooltip={t('fields:swapRelationship')}\n          />\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__removeButton`}\n            disabled={readOnly}\n            icon=\"x\"\n            onClick={(e) => {\n              e.preventDefault()\n              removeRelationship()\n            }}\n            round\n            tooltip={t('fields:removeRelationship')}\n          />\n        </div>\n      )}\n\n      {!!value && <DocumentDrawer onSave={updateRelationship} />}\n    </div>\n  )\n}\n\nexport const RelationshipComponent = (props: Props): React.ReactNode => {\n  return <Component {...props} />\n}\n"],
  "mappings": "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",
  "names": ["useLexicalComposerContext", "getTranslation", "Button", "useConfig", "usePayloadAPI", "useTranslation", "$getNodeByKey", "React", "useCallback", "useReducer", "useRef", "useState", "baseClass", "initialParams", "depth", "Component", "props", "data", "relationTo", "value", "nodeKey", "Error", "relationshipElemRef", "useRef", "editor", "useLexicalComposerContext", "fieldProps", "readOnly", "useEditorConfigContext", "config", "routes", "api", "serverURL", "getEntityConfig", "useConfig", "relatedCollection", "useState", "collectionSlug", "i18n", "t", "useTranslation", "cacheBust", "dispatchCacheBust", "useReducer", "state", "setParams", "usePayloadAPI", "slug", "closeDocumentDrawer", "DocumentDrawer", "DocumentDrawerToggler", "useLexicalDocumentDrawer", "id", "removeRelationship", "useCallback", "update", "$getNodeByKey", "remove", "updateRelationship", "React", "_jsxs", "className", "contentEditable", "ref", "_jsx", "label", "labels", "singular", "getTranslation", "admin", "useAsTitle", "isEditable", "Button", "buttonStyle", "disabled", "el", "icon", "onClick", "dispatchCommand", "INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND", "replace", "round", "tooltip", "e", "preventDefault", "onSave", "RelationshipComponent"]
}
