{"version":3,"sources":["../src/deleteOne.ts"],"sourcesContent":["import type { MongooseUpdateQueryOptions } from 'mongoose'\nimport type { DeleteOne } from 'payload'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { buildQuery } from './queries/buildQuery.js'\nimport { buildProjectionFromSelect } from './utilities/buildProjectionFromSelect.js'\nimport { getCollection } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { transform } from './utilities/transform.js'\n\nexport const deleteOne: DeleteOne = async function deleteOne(\n  this: MongooseAdapter,\n  { collection: collectionSlug, req, returning, select, where },\n) {\n  const { collectionConfig, Model } = getCollection({ adapter: this, collectionSlug })\n\n  const options: MongooseUpdateQueryOptions = {\n    projection: buildProjectionFromSelect({\n      adapter: this,\n      fields: collectionConfig.flattenedFields,\n      select,\n    }),\n    session: await getSession(this, req),\n  }\n\n  const query = await buildQuery({\n    adapter: this,\n    collectionSlug,\n    fields: collectionConfig.flattenedFields,\n    where,\n  })\n\n  if (returning === false) {\n    await Model.deleteOne(query, options)?.lean()\n    return null\n  }\n\n  const doc = await Model.findOneAndDelete(query, options)?.lean()\n\n  if (!doc) {\n    return null\n  }\n\n  transform({\n    adapter: this,\n    data: doc,\n    fields: collectionConfig.fields,\n    operation: 'read',\n  })\n\n  return doc\n}\n"],"names":["buildQuery","buildProjectionFromSelect","getCollection","getSession","transform","deleteOne","collection","collectionSlug","req","returning","select","where","collectionConfig","Model","adapter","options","projection","fields","flattenedFields","session","query","lean","doc","findOneAndDelete","data","operation"],"mappings":"AAKA,SAASA,UAAU,QAAQ,0BAAyB;AACpD,SAASC,yBAAyB,QAAQ,2CAA0C;AACpF,SAASC,aAAa,QAAQ,2BAA0B;AACxD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,YAAuB,eAAeA,UAEjD,EAAEC,YAAYC,cAAc,EAAEC,GAAG,EAAEC,SAAS,EAAEC,MAAM,EAAEC,KAAK,EAAE;IAE7D,MAAM,EAAEC,gBAAgB,EAAEC,KAAK,EAAE,GAAGX,cAAc;QAAEY,SAAS,IAAI;QAAEP;IAAe;IAElF,MAAMQ,UAAsC;QAC1CC,YAAYf,0BAA0B;YACpCa,SAAS,IAAI;YACbG,QAAQL,iBAAiBM,eAAe;YACxCR;QACF;QACAS,SAAS,MAAMhB,WAAW,IAAI,EAAEK;IAClC;IAEA,MAAMY,QAAQ,MAAMpB,WAAW;QAC7Bc,SAAS,IAAI;QACbP;QACAU,QAAQL,iBAAiBM,eAAe;QACxCP;IACF;IAEA,IAAIF,cAAc,OAAO;QACvB,MAAMI,MAAMR,SAAS,CAACe,OAAOL,UAAUM;QACvC,OAAO;IACT;IAEA,MAAMC,MAAM,MAAMT,MAAMU,gBAAgB,CAACH,OAAOL,UAAUM;IAE1D,IAAI,CAACC,KAAK;QACR,OAAO;IACT;IAEAlB,UAAU;QACRU,SAAS,IAAI;QACbU,MAAMF;QACNL,QAAQL,iBAAiBK,MAAM;QAC/BQ,WAAW;IACb;IAEA,OAAOH;AACT,EAAC"}