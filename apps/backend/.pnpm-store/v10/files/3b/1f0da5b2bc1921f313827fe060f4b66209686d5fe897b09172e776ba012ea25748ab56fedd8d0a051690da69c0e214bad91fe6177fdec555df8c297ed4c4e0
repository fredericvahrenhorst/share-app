{"version":3,"file":"index.js","names":["useDraggable","React","useRef","baseClass","DraggableWithClick","id","as","children","className","onClick","onKeyDown","ref","thresholdPixels","attributes","listeners","setNodeRef","initialPos","x","y","isDragging","handlePointerDown","e","current","clientX","clientY","handlePointerMove","moveEvent","deltaX","Math","abs","deltaY","onPointerDown","window","removeEventListener","cleanup","handlePointerUp","upEvent","addEventListener","Component","_jsx","role","tabIndex","trim","undefined","node"],"sources":["../../../../src/elements/FolderView/DraggableWithClick/index.tsx"],"sourcesContent":["import { useDraggable } from '@dnd-kit/core'\nimport React, { useRef } from 'react'\n\nimport './index.scss'\n\nconst baseClass = 'draggable-with-click'\n\ntype Props = {\n  readonly as?: React.ElementType\n  readonly children?: React.ReactNode\n  readonly className?: string\n  readonly id: string\n  readonly onClick: (e: React.MouseEvent) => void\n  readonly onKeyDown?: (e: React.KeyboardEvent) => void\n  readonly ref?: React.RefObject<HTMLDivElement>\n  readonly thresholdPixels?: number\n}\n\nexport const DraggableWithClick = ({\n  id,\n  as = 'div',\n  children,\n  className,\n  onClick,\n  onKeyDown,\n  ref,\n  thresholdPixels = 3,\n}: Props) => {\n  const { attributes, listeners, setNodeRef } = useDraggable({ id })\n  const initialPos = useRef({ x: 0, y: 0 })\n  const isDragging = useRef(false)\n\n  const handlePointerDown = (e) => {\n    initialPos.current = { x: e.clientX, y: e.clientY }\n    isDragging.current = false\n\n    const handlePointerMove = (moveEvent) => {\n      const deltaX = Math.abs(moveEvent.clientX - initialPos.current.x)\n      const deltaY = Math.abs(moveEvent.clientY - initialPos.current.y)\n      if (deltaX > thresholdPixels || deltaY > thresholdPixels) {\n        isDragging.current = true\n        if (listeners?.onPointerDown) {\n          listeners.onPointerDown(e)\n          // when the user starts dragging\n          // - call the click handler\n          // - remove the pointermove listener\n          onClick(moveEvent)\n        }\n        window.removeEventListener('pointermove', handlePointerMove)\n      }\n    }\n\n    const cleanup = () => {\n      window.removeEventListener('pointermove', handlePointerMove)\n      window.removeEventListener('pointerup', handlePointerUp)\n    }\n\n    const handlePointerUp = (upEvent) => {\n      cleanup()\n      if (!isDragging.current) {\n        // if the user did not drag the element\n        // - call the click handler\n        onClick(upEvent)\n      }\n    }\n\n    window.addEventListener('pointermove', handlePointerMove)\n    window.addEventListener('pointerup', handlePointerUp)\n  }\n\n  const Component = as || 'div'\n\n  return (\n    <Component\n      role=\"button\"\n      tabIndex={0}\n      {...attributes}\n      className={`${baseClass} ${className || ''}`.trim()}\n      onKeyDown={onKeyDown}\n      onPointerDown={onClick ? handlePointerDown : undefined}\n      ref={(node) => {\n        setNodeRef(node)\n        if (ref) {\n          ref.current = node\n        }\n      }}\n    >\n      {children}\n    </Component>\n  )\n}\n"],"mappings":";AAAA,SAASA,YAAY,QAAQ;AAC7B,OAAOC,KAAA,IAASC,MAAM,QAAQ;AAE9B,OAAO;AAEP,MAAMC,SAAA,GAAY;AAalB,OAAO,MAAMC,kBAAA,GAAqBA,CAAC;EACjCC,EAAE;EACFC,EAAA,GAAK,KAAK;EACVC,QAAQ;EACRC,SAAS;EACTC,OAAO;EACPC,SAAS;EACTC,GAAG;EACHC,eAAA,GAAkB;AAAC,CACb;EACN,MAAM;IAAEC,UAAU;IAAEC,SAAS;IAAEC;EAAU,CAAE,GAAGf,YAAA,CAAa;IAAEK;EAAG;EAChE,MAAMW,UAAA,GAAad,MAAA,CAAO;IAAEe,CAAA,EAAG;IAAGC,CAAA,EAAG;EAAE;EACvC,MAAMC,UAAA,GAAajB,MAAA,CAAO;EAE1B,MAAMkB,iBAAA,GAAqBC,CAAA;IACzBL,UAAA,CAAWM,OAAO,GAAG;MAAEL,CAAA,EAAGI,CAAA,CAAEE,OAAO;MAAEL,CAAA,EAAGG,CAAA,CAAEG;IAAQ;IAClDL,UAAA,CAAWG,OAAO,GAAG;IAErB,MAAMG,iBAAA,GAAqBC,SAAA;MACzB,MAAMC,MAAA,GAASC,IAAA,CAAKC,GAAG,CAACH,SAAA,CAAUH,OAAO,GAAGP,UAAA,CAAWM,OAAO,CAACL,CAAC;MAChE,MAAMa,MAAA,GAASF,IAAA,CAAKC,GAAG,CAACH,SAAA,CAAUF,OAAO,GAAGR,UAAA,CAAWM,OAAO,CAACJ,CAAC;MAChE,IAAIS,MAAA,GAASf,eAAA,IAAmBkB,MAAA,GAASlB,eAAA,EAAiB;QACxDO,UAAA,CAAWG,OAAO,GAAG;QACrB,IAAIR,SAAA,EAAWiB,aAAA,EAAe;UAC5BjB,SAAA,CAAUiB,aAAa,CAACV,CAAA;UACxB;UACA;UACA;UACAZ,OAAA,CAAQiB,SAAA;QACV;QACAM,MAAA,CAAOC,mBAAmB,CAAC,eAAeR,iBAAA;MAC5C;IACF;IAEA,MAAMS,OAAA,GAAUA,CAAA;MACdF,MAAA,CAAOC,mBAAmB,CAAC,eAAeR,iBAAA;MAC1CO,MAAA,CAAOC,mBAAmB,CAAC,aAAaE,eAAA;IAC1C;IAEA,MAAMA,eAAA,GAAmBC,OAAA;MACvBF,OAAA;MACA,IAAI,CAACf,UAAA,CAAWG,OAAO,EAAE;QACvB;QACA;QACAb,OAAA,CAAQ2B,OAAA;MACV;IACF;IAEAJ,MAAA,CAAOK,gBAAgB,CAAC,eAAeZ,iBAAA;IACvCO,MAAA,CAAOK,gBAAgB,CAAC,aAAaF,eAAA;EACvC;EAEA,MAAMG,SAAA,GAAYhC,EAAA,IAAM;EAExB,oBACEiC,IAAA,CAACD,SAAA;IACCE,IAAA,EAAK;IACLC,QAAA,EAAU;IACT,GAAG5B,UAAU;IACdL,SAAA,EAAW,GAAGL,SAAA,IAAaK,SAAA,IAAa,IAAI,CAACkC,IAAI;IACjDhC,SAAA,EAAWA,SAAA;IACXqB,aAAA,EAAetB,OAAA,GAAUW,iBAAA,GAAoBuB,SAAA;IAC7ChC,GAAA,EAAMiC,IAAA;MACJ7B,UAAA,CAAW6B,IAAA;MACX,IAAIjC,GAAA,EAAK;QACPA,GAAA,CAAIW,OAAO,GAAGsB,IAAA;MAChB;IACF;cAECrC;;AAGP","ignoreList":[]}