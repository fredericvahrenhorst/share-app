{"version":3,"file":"index.js","names":["HydrateAuthProvider","SetStepNav","RenderServerComponent","EntityType","groupNavItems","React","Fragment","DefaultDashboard","Dashboard","initPageResult","params","searchParams","locale","permissions","req","i18n","payload","config","user","visibleEntities","collections","filter","collection","slug","read","includes","globals","global","globalData","length","lockedDocuments","find","depth","overrideAccess","pagination","where","globalSlug","exists","map","lockDurationDefault","lockDuration","lockDocuments","duration","lockedDoc","docs","doc","data","_isLocked","_lastEditedAt","updatedAt","_userEditing","value","navGroups","entityToGroup","type","entity","_jsxs","_jsx","nav","clientProps","Component","admin","components","views","dashboard","Fallback","importMap","serverProps"],"sources":["../../../src/views/Dashboard/index.tsx"],"sourcesContent":["import type { EntityToGroup } from '@payloadcms/ui/shared'\nimport type { AdminViewServerProps } from 'payload'\n\nimport { HydrateAuthProvider, SetStepNav } from '@payloadcms/ui'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { EntityType, groupNavItems } from '@payloadcms/ui/shared'\nimport React, { Fragment } from 'react'\n\nimport type { DashboardViewClientProps, DashboardViewServerPropsOnly } from './Default/index.js'\n\nimport { DefaultDashboard } from './Default/index.js'\n\nexport async function Dashboard({ initPageResult, params, searchParams }: AdminViewServerProps) {\n  const {\n    locale,\n    permissions,\n    req: {\n      i18n,\n      payload: { config },\n      payload,\n      user,\n    },\n    req,\n    visibleEntities,\n  } = initPageResult\n\n  const collections = config.collections.filter(\n    (collection) =>\n      permissions?.collections?.[collection.slug]?.read &&\n      visibleEntities.collections.includes(collection.slug),\n  )\n\n  const globals = config.globals.filter(\n    (global) =>\n      permissions?.globals?.[global.slug]?.read && visibleEntities.globals.includes(global.slug),\n  )\n\n  // Query locked global documents only if there are globals in the config\n  let globalData = []\n\n  if (config.globals.length > 0) {\n    const lockedDocuments = await payload.find({\n      collection: 'payload-locked-documents',\n      depth: 1,\n      overrideAccess: false,\n      pagination: false,\n      req,\n      where: {\n        globalSlug: {\n          exists: true,\n        },\n      },\n    })\n\n    // Map over globals to include `lockDuration` and lock data for each global slug\n    globalData = config.globals.map((global) => {\n      const lockDurationDefault = 300\n      const lockDuration =\n        typeof global.lockDocuments === 'object'\n          ? global.lockDocuments.duration\n          : lockDurationDefault\n\n      const lockedDoc = lockedDocuments.docs.find((doc) => doc.globalSlug === global.slug)\n\n      return {\n        slug: global.slug,\n        data: {\n          _isLocked: !!lockedDoc,\n          _lastEditedAt: lockedDoc?.updatedAt ?? null,\n          _userEditing: lockedDoc?.user?.value ?? null,\n        },\n        lockDuration,\n      }\n    })\n  }\n\n  const navGroups = groupNavItems(\n    [\n      ...(collections.map((collection) => {\n        const entityToGroup: EntityToGroup = {\n          type: EntityType.collection,\n          entity: collection,\n        }\n\n        return entityToGroup\n      }) ?? []),\n      ...(globals.map((global) => {\n        const entityToGroup: EntityToGroup = {\n          type: EntityType.global,\n          entity: global,\n        }\n\n        return entityToGroup\n      }) ?? []),\n    ],\n    permissions,\n    i18n,\n  )\n\n  return (\n    <Fragment>\n      <HydrateAuthProvider permissions={permissions} />\n      <SetStepNav nav={[]} />\n      {RenderServerComponent({\n        clientProps: {\n          locale,\n        } satisfies DashboardViewClientProps,\n        Component: config.admin?.components?.views?.dashboard?.Component,\n        Fallback: DefaultDashboard,\n        importMap: payload.importMap,\n        serverProps: {\n          globalData,\n          i18n,\n          locale,\n          navGroups,\n          params,\n          payload,\n          permissions,\n          searchParams,\n          user,\n          visibleEntities,\n        } satisfies DashboardViewServerPropsOnly,\n      })}\n    </Fragment>\n  )\n}\n"],"mappings":"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","ignoreList":[]}