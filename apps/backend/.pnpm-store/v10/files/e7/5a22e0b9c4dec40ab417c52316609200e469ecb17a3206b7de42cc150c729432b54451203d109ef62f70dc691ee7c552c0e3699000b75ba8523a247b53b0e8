{"version":3,"file":"index.js","names":["RenderServerComponent","getClientConfig","notFound","redirect","parseDocumentID","formatAdminURL","React","DefaultTemplate","MinimalTemplate","initPage","getRouteData","RootPage","config","configPromise","importMap","params","paramsPromise","searchParams","searchParamsPromise","admin","routes","createFirstUser","_createFirstUserRoute","user","userSlug","adminRoute","currentRoute","path","Array","isArray","segments","join","browseByFolderSlugs","DefaultView","documentSubViewType","folderID","folderIDParam","initPageOptions","serverProps","templateClassName","templateType","viewType","initPageResult","dbHasUser","req","payload","db","findOne","collection","then","doc","Component","payloadComponent","redirectTo","createFirstUserRoute","collectionConfig","collections","find","slug","disableLocalStrategy","auth","clientConfig","i18n","folders","id","collectionSlug","undefined","RenderedView","clientProps","Fallback","docID","_jsxs","Fragment","_jsx","className","globalSlug","globalConfig","locale","permissions","viewActions","visibleEntities","globals"],"sources":["../../../src/views/Root/index.tsx"],"sourcesContent":["import type { I18nClient } from '@payloadcms/translations'\nimport type { Metadata } from 'next'\n\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { getClientConfig } from '@payloadcms/ui/utilities/getClientConfig'\nimport { notFound, redirect } from 'next/navigation.js'\nimport {\n  type AdminViewClientProps,\n  type AdminViewServerPropsOnly,\n  type ImportMap,\n  parseDocumentID,\n  type SanitizedConfig,\n} from 'payload'\nimport { formatAdminURL } from 'payload/shared'\nimport React from 'react'\n\nimport { DefaultTemplate } from '../../templates/Default/index.js'\nimport { MinimalTemplate } from '../../templates/Minimal/index.js'\nimport { initPage } from '../../utilities/initPage/index.js'\nimport { getRouteData } from './getRouteData.js'\n\nexport type GenerateViewMetadata = (args: {\n  config: SanitizedConfig\n  i18n: I18nClient\n  isEditing?: boolean\n  params?: { [key: string]: string | string[] }\n}) => Promise<Metadata>\n\nexport const RootPage = async ({\n  config: configPromise,\n  importMap,\n  params: paramsPromise,\n  searchParams: searchParamsPromise,\n}: {\n  readonly config: Promise<SanitizedConfig>\n  readonly importMap: ImportMap\n  readonly params: Promise<{\n    segments: string[]\n  }>\n  readonly searchParams: Promise<{\n    [key: string]: string | string[]\n  }>\n}) => {\n  const config = await configPromise\n\n  const {\n    admin: {\n      routes: { createFirstUser: _createFirstUserRoute },\n      user: userSlug,\n    },\n    routes: { admin: adminRoute },\n  } = config\n\n  const params = await paramsPromise\n\n  const currentRoute = formatAdminURL({\n    adminRoute,\n    path: Array.isArray(params.segments) ? `/${params.segments.join('/')}` : null,\n  })\n\n  const segments = Array.isArray(params.segments) ? params.segments : []\n\n  const searchParams = await searchParamsPromise\n\n  const {\n    browseByFolderSlugs,\n    DefaultView,\n    documentSubViewType,\n    folderID: folderIDParam,\n    initPageOptions,\n    serverProps,\n    templateClassName,\n    templateType,\n    viewType,\n  } = getRouteData({\n    adminRoute,\n    config,\n    currentRoute,\n    importMap,\n    searchParams,\n    segments,\n  })\n\n  const initPageResult = await initPage(initPageOptions)\n\n  const dbHasUser =\n    initPageResult.req.user ||\n    (await initPageResult?.req.payload.db\n      .findOne({\n        collection: userSlug,\n        req: initPageResult?.req,\n      })\n      ?.then((doc) => !!doc))\n\n  /**\n   * This function is responsible for handling the case where the view is not found.\n   * The current route did not match any default views or custom route views.\n   */\n  if (!DefaultView?.Component && !DefaultView?.payloadComponent) {\n    if (initPageResult?.req?.user) {\n      notFound()\n    }\n\n    if (dbHasUser) {\n      redirect(adminRoute)\n    }\n  }\n\n  if (typeof initPageResult?.redirectTo === 'string') {\n    redirect(initPageResult.redirectTo)\n  }\n\n  if (initPageResult) {\n    const createFirstUserRoute = formatAdminURL({ adminRoute, path: _createFirstUserRoute })\n\n    const collectionConfig = config.collections.find(({ slug }) => slug === userSlug)\n    const disableLocalStrategy = collectionConfig?.auth?.disableLocalStrategy\n\n    if (disableLocalStrategy && currentRoute === createFirstUserRoute) {\n      redirect(adminRoute)\n    }\n\n    if (!dbHasUser && currentRoute !== createFirstUserRoute && !disableLocalStrategy) {\n      redirect(createFirstUserRoute)\n    }\n\n    if (dbHasUser && currentRoute === createFirstUserRoute) {\n      redirect(adminRoute)\n    }\n  }\n\n  if (!DefaultView?.Component && !DefaultView?.payloadComponent && !dbHasUser) {\n    redirect(adminRoute)\n  }\n\n  const clientConfig = getClientConfig({\n    config,\n    i18n: initPageResult?.req.i18n,\n    importMap,\n  })\n\n  const payload = initPageResult?.req.payload\n  const folderID = payload.config.folders\n    ? parseDocumentID({\n        id: folderIDParam,\n        collectionSlug: payload.config.folders.slug,\n        payload,\n      })\n    : undefined\n\n  const RenderedView = RenderServerComponent({\n    clientProps: {\n      browseByFolderSlugs,\n      clientConfig,\n      documentSubViewType,\n      viewType,\n    } satisfies AdminViewClientProps,\n    Component: DefaultView.payloadComponent,\n    Fallback: DefaultView.Component,\n    importMap,\n    serverProps: {\n      ...serverProps,\n      clientConfig,\n      docID: initPageResult?.docID,\n      folderID,\n      i18n: initPageResult?.req.i18n,\n      importMap,\n      initPageResult,\n      params,\n      payload: initPageResult?.req.payload,\n      searchParams,\n    } satisfies AdminViewServerPropsOnly,\n  })\n\n  return (\n    <React.Fragment>\n      {!templateType && <React.Fragment>{RenderedView}</React.Fragment>}\n      {templateType === 'minimal' && (\n        <MinimalTemplate className={templateClassName}>{RenderedView}</MinimalTemplate>\n      )}\n      {templateType === 'default' && (\n        <DefaultTemplate\n          collectionSlug={initPageResult?.collectionConfig?.slug}\n          docID={initPageResult?.docID}\n          documentSubViewType={documentSubViewType}\n          globalSlug={initPageResult?.globalConfig?.slug}\n          i18n={initPageResult?.req.i18n}\n          locale={initPageResult?.locale}\n          params={params}\n          payload={initPageResult?.req.payload}\n          permissions={initPageResult?.permissions}\n          req={initPageResult?.req}\n          searchParams={searchParams}\n          user={initPageResult?.req.user}\n          viewActions={serverProps.viewActions}\n          viewType={viewType}\n          visibleEntities={{\n            // The reason we are not passing in initPageResult.visibleEntities directly is due to a \"Cannot assign to read only property of object '#<Object>\" error introduced in React 19\n            // which this caused as soon as initPageResult.visibleEntities is passed in\n            collections: initPageResult?.visibleEntities?.collections,\n            globals: initPageResult?.visibleEntities?.globals,\n          }}\n        >\n          {RenderedView}\n        </DefaultTemplate>\n      )}\n    </React.Fragment>\n  )\n}\n"],"mappings":";AAGA,SAASA,qBAAqB,QAAQ;AACtC,SAASC,eAAe,QAAQ;AAChC,SAASC,QAAQ,EAAEC,QAAQ,QAAQ;AACnC,SAIEC,eAAe,QAEV;AACP,SAASC,cAAc,QAAQ;AAC/B,OAAOC,KAAA,MAAW;AAElB,SAASC,eAAe,QAAQ;AAChC,SAASC,eAAe,QAAQ;AAChC,SAASC,QAAQ,QAAQ;AACzB,SAASC,YAAY,QAAQ;AAS7B,OAAO,MAAMC,QAAA,GAAW,MAAAA,CAAO;EAC7BC,MAAA,EAAQC,aAAa;EACrBC,SAAS;EACTC,MAAA,EAAQC,aAAa;EACrBC,YAAA,EAAcC;AAAmB,CAUlC;EACC,MAAMN,MAAA,GAAS,MAAMC,aAAA;EAErB,MAAM;IACJM,KAAA,EAAO;MACLC,MAAA,EAAQ;QAAEC,eAAA,EAAiBC;MAAqB,CAAE;MAClDC,IAAA,EAAMC;IAAQ,CACf;IACDJ,MAAA,EAAQ;MAAED,KAAA,EAAOM;IAAU;EAAE,CAC9B,GAAGb,MAAA;EAEJ,MAAMG,MAAA,GAAS,MAAMC,aAAA;EAErB,MAAMU,YAAA,GAAerB,cAAA,CAAe;IAClCoB,UAAA;IACAE,IAAA,EAAMC,KAAA,CAAMC,OAAO,CAACd,MAAA,CAAOe,QAAQ,IAAI,IAAIf,MAAA,CAAOe,QAAQ,CAACC,IAAI,CAAC,MAAM,GAAG;EAC3E;EAEA,MAAMD,QAAA,GAAWF,KAAA,CAAMC,OAAO,CAACd,MAAA,CAAOe,QAAQ,IAAIf,MAAA,CAAOe,QAAQ,GAAG,EAAE;EAEtE,MAAMb,YAAA,GAAe,MAAMC,mBAAA;EAE3B,MAAM;IACJc,mBAAmB;IACnBC,WAAW;IACXC,mBAAmB;IACnBC,QAAA,EAAUC,aAAa;IACvBC,eAAe;IACfC,WAAW;IACXC,iBAAiB;IACjBC,YAAY;IACZC;EAAQ,CACT,GAAG/B,YAAA,CAAa;IACfe,UAAA;IACAb,MAAA;IACAc,YAAA;IACAZ,SAAA;IACAG,YAAA;IACAa;EACF;EAEA,MAAMY,cAAA,GAAiB,MAAMjC,QAAA,CAAS4B,eAAA;EAEtC,MAAMM,SAAA,GACJD,cAAA,CAAeE,GAAG,CAACrB,IAAI,KACtB,MAAMmB,cAAA,EAAgBE,GAAA,CAAIC,OAAA,CAAQC,EAAA,CAChCC,OAAA,CAAQ;IACPC,UAAA,EAAYxB,QAAA;IACZoB,GAAA,EAAKF,cAAA,EAAgBE;EACvB,IACEK,IAAA,CAAMC,GAAA,IAAQ,CAAC,CAACA,GAAA;EAEtB;;;;EAIA,IAAI,CAACjB,WAAA,EAAakB,SAAA,IAAa,CAAClB,WAAA,EAAamB,gBAAA,EAAkB;IAC7D,IAAIV,cAAA,EAAgBE,GAAA,EAAKrB,IAAA,EAAM;MAC7BrB,QAAA;IACF;IAEA,IAAIyC,SAAA,EAAW;MACbxC,QAAA,CAASsB,UAAA;IACX;EACF;EAEA,IAAI,OAAOiB,cAAA,EAAgBW,UAAA,KAAe,UAAU;IAClDlD,QAAA,CAASuC,cAAA,CAAeW,UAAU;EACpC;EAEA,IAAIX,cAAA,EAAgB;IAClB,MAAMY,oBAAA,GAAuBjD,cAAA,CAAe;MAAEoB,UAAA;MAAYE,IAAA,EAAML;IAAsB;IAEtF,MAAMiC,gBAAA,GAAmB3C,MAAA,CAAO4C,WAAW,CAACC,IAAI,CAAC,CAAC;MAAEC;IAAI,CAAE,KAAKA,IAAA,KAASlC,QAAA;IACxE,MAAMmC,oBAAA,GAAuBJ,gBAAA,EAAkBK,IAAA,EAAMD,oBAAA;IAErD,IAAIA,oBAAA,IAAwBjC,YAAA,KAAiB4B,oBAAA,EAAsB;MACjEnD,QAAA,CAASsB,UAAA;IACX;IAEA,IAAI,CAACkB,SAAA,IAAajB,YAAA,KAAiB4B,oBAAA,IAAwB,CAACK,oBAAA,EAAsB;MAChFxD,QAAA,CAASmD,oBAAA;IACX;IAEA,IAAIX,SAAA,IAAajB,YAAA,KAAiB4B,oBAAA,EAAsB;MACtDnD,QAAA,CAASsB,UAAA;IACX;EACF;EAEA,IAAI,CAACQ,WAAA,EAAakB,SAAA,IAAa,CAAClB,WAAA,EAAamB,gBAAA,IAAoB,CAACT,SAAA,EAAW;IAC3ExC,QAAA,CAASsB,UAAA;EACX;EAEA,MAAMoC,YAAA,GAAe5D,eAAA,CAAgB;IACnCW,MAAA;IACAkD,IAAA,EAAMpB,cAAA,EAAgBE,GAAA,CAAIkB,IAAA;IAC1BhD;EACF;EAEA,MAAM+B,OAAA,GAAUH,cAAA,EAAgBE,GAAA,CAAIC,OAAA;EACpC,MAAMV,QAAA,GAAWU,OAAA,CAAQjC,MAAM,CAACmD,OAAO,GACnC3D,eAAA,CAAgB;IACd4D,EAAA,EAAI5B,aAAA;IACJ6B,cAAA,EAAgBpB,OAAA,CAAQjC,MAAM,CAACmD,OAAO,CAACL,IAAI;IAC3Cb;EACF,KACAqB,SAAA;EAEJ,MAAMC,YAAA,GAAenE,qBAAA,CAAsB;IACzCoE,WAAA,EAAa;MACXpC,mBAAA;MACA6B,YAAA;MACA3B,mBAAA;MACAO;IACF;IACAU,SAAA,EAAWlB,WAAA,CAAYmB,gBAAgB;IACvCiB,QAAA,EAAUpC,WAAA,CAAYkB,SAAS;IAC/BrC,SAAA;IACAwB,WAAA,EAAa;MACX,GAAGA,WAAW;MACduB,YAAA;MACAS,KAAA,EAAO5B,cAAA,EAAgB4B,KAAA;MACvBnC,QAAA;MACA2B,IAAA,EAAMpB,cAAA,EAAgBE,GAAA,CAAIkB,IAAA;MAC1BhD,SAAA;MACA4B,cAAA;MACA3B,MAAA;MACA8B,OAAA,EAASH,cAAA,EAAgBE,GAAA,CAAIC,OAAA;MAC7B5B;IACF;EACF;EAEA,oBACEsD,KAAA,CAACjE,KAAA,CAAMkE,QAAQ;eACZ,CAAChC,YAAA,iBAAgBiC,IAAA,CAACnE,KAAA,CAAMkE,QAAQ;gBAAEL;QAClC3B,YAAA,KAAiB,0BAChBiC,IAAA,CAACjE,eAAA;MAAgBkE,SAAA,EAAWnC,iBAAA;gBAAoB4B;QAEjD3B,YAAA,KAAiB,0BAChBiC,IAAA,CAAClE,eAAA;MACC0D,cAAA,EAAgBvB,cAAA,EAAgBa,gBAAA,EAAkBG,IAAA;MAClDY,KAAA,EAAO5B,cAAA,EAAgB4B,KAAA;MACvBpC,mBAAA,EAAqBA,mBAAA;MACrByC,UAAA,EAAYjC,cAAA,EAAgBkC,YAAA,EAAclB,IAAA;MAC1CI,IAAA,EAAMpB,cAAA,EAAgBE,GAAA,CAAIkB,IAAA;MAC1Be,MAAA,EAAQnC,cAAA,EAAgBmC,MAAA;MACxB9D,MAAA,EAAQA,MAAA;MACR8B,OAAA,EAASH,cAAA,EAAgBE,GAAA,CAAIC,OAAA;MAC7BiC,WAAA,EAAapC,cAAA,EAAgBoC,WAAA;MAC7BlC,GAAA,EAAKF,cAAA,EAAgBE,GAAA;MACrB3B,YAAA,EAAcA,YAAA;MACdM,IAAA,EAAMmB,cAAA,EAAgBE,GAAA,CAAIrB,IAAA;MAC1BwD,WAAA,EAAazC,WAAA,CAAYyC,WAAW;MACpCtC,QAAA,EAAUA,QAAA;MACVuC,eAAA,EAAiB;QACf;QACA;QACAxB,WAAA,EAAad,cAAA,EAAgBsC,eAAA,EAAiBxB,WAAA;QAC9CyB,OAAA,EAASvC,cAAA,EAAgBsC,eAAA,EAAiBC;MAC5C;gBAECd;;;AAKX","ignoreList":[]}