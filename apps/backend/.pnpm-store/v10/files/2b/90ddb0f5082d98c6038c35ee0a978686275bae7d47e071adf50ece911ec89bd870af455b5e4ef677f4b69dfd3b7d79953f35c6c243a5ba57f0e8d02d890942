{"version":3,"file":"index.js","names":["c","_c","Drawer","LoadingOverlay","toast","useEditDepth","useModal","useServerFunctions","useTranslation","useSearchParams","React","useCallback","useEffect","useId","useMemo","useRef","useState","baseClass","formatVersionDrawerSlug","depth","uuid","VersionDrawerContent","props","collectionSlug","docID","drawerSlug","globalSlug","closeModal","searchParams","prevSearchParams","renderDocument","DocumentView","setDocumentView","undefined","isLoading","setIsLoading","hasRenderedDocument","t","getDocumentView","fetchDocumentView","isGlobal","Boolean","entitySlug","result","paramsOverride","segments","String","filter","redirectAfterDelete","redirectAfterDuplicate","Object","fromEntries","entries","versions","disableGutter","useVersionDrawerCreatedAtCell","Document","error","message","current","_jsx","VersionDrawer","$","t0","className","gutter","slug","title","children","useVersionDrawer","drawerDepth","modalState","openModal","toggleModal","isOpen","setIsOpen","t1","t2","t3","t4","toggleDrawer","t5","closeDrawer","t6","openDrawer","t7","t8","MemoizedDrawer","t9","t10","isDrawerOpen"],"sources":["../../../../../src/views/Version/SelectComparison/VersionDrawer/index.tsx"],"sourcesContent":["'use client'\nimport {\n  Drawer,\n  LoadingOverlay,\n  toast,\n  useEditDepth,\n  useModal,\n  useServerFunctions,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { useSearchParams } from 'next/navigation.js'\n\nimport './index.scss'\n\nimport React, { useCallback, useEffect, useId, useMemo, useRef, useState } from 'react'\n\nexport const baseClass = 'version-drawer'\nexport const formatVersionDrawerSlug = ({\n  depth,\n  uuid,\n}: {\n  depth: number\n  uuid: string // supply when creating a new document and no id is available\n}) => `version-drawer_${depth}_${uuid}`\n\nexport const VersionDrawerContent: React.FC<{\n  collectionSlug?: string\n  docID?: number | string\n  drawerSlug: string\n  globalSlug?: string\n}> = (props) => {\n  const { collectionSlug, docID, drawerSlug, globalSlug } = props\n  const { closeModal } = useModal()\n  const searchParams = useSearchParams()\n  const prevSearchParams = useRef(searchParams)\n\n  const { renderDocument } = useServerFunctions()\n\n  const [DocumentView, setDocumentView] = useState<React.ReactNode>(undefined)\n  const [isLoading, setIsLoading] = useState(true)\n  const hasRenderedDocument = useRef(false)\n  const { t } = useTranslation()\n\n  const getDocumentView = useCallback(\n    (docID?: number | string) => {\n      const fetchDocumentView = async () => {\n        setIsLoading(true)\n\n        try {\n          const isGlobal = Boolean(globalSlug)\n          const entitySlug = collectionSlug ?? globalSlug\n\n          const result = await renderDocument({\n            collectionSlug: entitySlug,\n            docID,\n            drawerSlug,\n            paramsOverride: {\n              segments: [\n                isGlobal ? 'globals' : 'collections',\n                entitySlug,\n                isGlobal ? undefined : String(docID),\n                'versions',\n              ].filter(Boolean),\n            },\n            redirectAfterDelete: false,\n            redirectAfterDuplicate: false,\n            searchParams: Object.fromEntries(searchParams.entries()),\n            versions: {\n              disableGutter: true,\n              useVersionDrawerCreatedAtCell: true,\n            },\n          })\n\n          if (result?.Document) {\n            setDocumentView(result.Document)\n            setIsLoading(false)\n          }\n        } catch (error) {\n          toast.error(error?.message || t('error:unspecific'))\n          closeModal(drawerSlug)\n          // toast.error(data?.errors?.[0].message || t('error:unspecific'))\n        }\n      }\n\n      void fetchDocumentView()\n    },\n    [closeModal, collectionSlug, globalSlug, drawerSlug, renderDocument, searchParams, t],\n  )\n\n  useEffect(() => {\n    if (!hasRenderedDocument.current || prevSearchParams.current !== searchParams) {\n      prevSearchParams.current = searchParams\n      getDocumentView(docID)\n      hasRenderedDocument.current = true\n    }\n  }, [docID, getDocumentView, searchParams])\n\n  if (isLoading) {\n    return <LoadingOverlay />\n  }\n\n  return DocumentView\n}\nexport const VersionDrawer: React.FC<{\n  collectionSlug?: string\n  docID?: number | string\n  drawerSlug: string\n  globalSlug?: string\n}> = (props) => {\n  const { collectionSlug, docID, drawerSlug, globalSlug } = props\n  const { t } = useTranslation()\n\n  return (\n    <Drawer\n      className={baseClass}\n      gutter={true}\n      slug={drawerSlug}\n      title={t('version:selectVersionToCompare')}\n    >\n      <VersionDrawerContent\n        collectionSlug={collectionSlug}\n        docID={docID}\n        drawerSlug={drawerSlug}\n        globalSlug={globalSlug}\n      />\n    </Drawer>\n  )\n}\n\nexport const useVersionDrawer = ({\n  collectionSlug,\n  docID,\n  globalSlug,\n}: {\n  collectionSlug?: string\n  docID?: number | string\n  globalSlug?: string\n}) => {\n  const drawerDepth = useEditDepth()\n  const uuid = useId()\n  const { closeModal, modalState, openModal, toggleModal } = useModal()\n  const [isOpen, setIsOpen] = useState(false)\n\n  const drawerSlug = formatVersionDrawerSlug({\n    depth: drawerDepth,\n    uuid,\n  })\n\n  useEffect(() => {\n    setIsOpen(Boolean(modalState[drawerSlug]?.isOpen))\n  }, [modalState, drawerSlug])\n\n  const toggleDrawer = useCallback(() => {\n    toggleModal(drawerSlug)\n  }, [toggleModal, drawerSlug])\n\n  const closeDrawer = useCallback(() => {\n    closeModal(drawerSlug)\n  }, [drawerSlug, closeModal])\n\n  const openDrawer = useCallback(() => {\n    openModal(drawerSlug)\n  }, [drawerSlug, openModal])\n\n  const MemoizedDrawer = useMemo(() => {\n    return () => (\n      <VersionDrawer\n        collectionSlug={collectionSlug}\n        docID={docID}\n        drawerSlug={drawerSlug}\n        globalSlug={globalSlug}\n      />\n    )\n  }, [collectionSlug, docID, drawerSlug, globalSlug])\n\n  return useMemo(\n    () => ({\n      closeDrawer,\n      Drawer: MemoizedDrawer,\n      drawerDepth,\n      drawerSlug,\n      isDrawerOpen: isOpen,\n      openDrawer,\n      toggleDrawer,\n    }),\n    [MemoizedDrawer, closeDrawer, drawerDepth, drawerSlug, isOpen, openDrawer, toggleDrawer],\n  )\n}\n"],"mappings":"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","ignoreList":[]}