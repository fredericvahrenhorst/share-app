import{b as F}from"./chunk-BZZVLW4U.js";import{c as V}from"react/compiler-runtime";import{jsx as R}from"react/jsx-runtime";import{Drawer as q,EditDepthProvider as z,useModal as G}from"@payloadcms/ui";import"react";import{jsx as E,jsxs as O}from"react/jsx-runtime";import{Form as M,FormSubmit as v,RenderFields as T,useDocumentForm as $,useDocumentInfo as N,useServerFunctions as W,useTranslation as k}from"@payloadcms/ui";import{abortAndIgnore as P}from"@payloadcms/ui/shared";import{deepCopyObjectSimpleWithoutReactComponents as y}from"payload/shared";import{useCallback as B,useEffect as I,useRef as H,useState as L}from"react";import{v4 as U}from"uuid";var j=({data:i,featureKey:e,fieldMapOverride:o,handleDrawerSubmit:n,schemaFieldsPathOverride:t,schemaPath:d,schemaPathSuffix:f})=>{let{t:p}=k(),{id:l,collectionSlug:c,getDocPreferences:u,globalSlug:a}=N(),{fields:s}=$(),m=H(new AbortController),[r,h]=L(!1),{fieldProps:{featureClientSchemaMap:w}}=F(),{getFormState:S}=W(),C=t??`${d}.lexical_internal_feature.${e}${f?`.${f}`:""}`,b=o??w[e]?.[C];I(()=>{let g=new AbortController;return(async()=>{let{state:_}=await S({id:l,collectionSlug:c,data:i??{},docPermissions:{fields:!0},docPreferences:await u(),documentFormState:y(s),globalSlug:a,initialBlockData:i,operation:"update",renderAllFields:!0,schemaPath:C,signal:g.signal});h(_)})(),()=>{P(g)}},[C,l,i,S,c,a,u,s]);let x=B(async({formState:g})=>{P(m.current);let A=new AbortController;m.current=A;let{state:_}=await S({id:l,collectionSlug:c,docPermissions:{fields:!0},docPreferences:await u(),documentFormState:y(s),formState:g,globalSlug:a,initialBlockFormState:g,operation:"update",schemaPath:C,signal:A.signal});return _||g},[S,l,c,u,s,a,C]);return I(()=>()=>{P(m.current)},[]),r===!1?null:O(M,{beforeSubmit:[x],disableValidationOnSubmit:!0,fields:Array.isArray(b)?b:[],initialState:r,onChange:[x],onSubmit:n,uuid:U(),children:[E(T,{fields:Array.isArray(b)?b:[],forceRender:!0,parentIndexPath:"",parentPath:"",parentSchemaPath:C,permissions:!0,readOnly:!1}),E(v,{children:p("fields:saveChanges")})]})};var Ce=i=>{let e=V(15),{className:o,data:n,drawerSlug:t,drawerTitle:d,featureKey:f,fieldMapOverride:p,handleDrawerSubmit:l,schemaFieldsPathOverride:c,schemaPath:u,schemaPathSuffix:a}=i,{closeModal:s}=G(),m=d??"",r;e[0]!==s||e[1]!==t||e[2]!==l?(r=(w,S)=>{s(t),setTimeout(()=>{l(w,S)},1)},e[0]=s,e[1]=t,e[2]=l,e[3]=r):r=e[3];let h;return e[4]!==o||e[5]!==n||e[6]!==t||e[7]!==f||e[8]!==p||e[9]!==c||e[10]!==u||e[11]!==a||e[12]!==m||e[13]!==r?(h=R(z,{children:R(q,{className:o,slug:t,title:m,children:R(j,{data:n,featureKey:f,fieldMapOverride:p,handleDrawerSubmit:r,schemaFieldsPathOverride:c,schemaPath:u,schemaPathSuffix:a})})}),e[4]=o,e[5]=n,e[6]=t,e[7]=f,e[8]=p,e[9]=c,e[10]=u,e[11]=a,e[12]=m,e[13]=r,e[14]=h):h=e[14],h};import{c as J}from"react/compiler-runtime";import{jsx as K}from"react/jsx-runtime";import{useAuth as Q,useConfig as X,useEntityVisibility as Y}from"@payloadcms/ui";import*as D from"react";var Z=(i,e)=>i.filter(({slug:o,admin:{enableRichTextRelationship:n},upload:t})=>e?.visibleEntities?.collections.includes(o)?e?.uploads?n&&!!t:t?!1:n:!1),we=i=>{let e=J(20),o,n,t,d;e[0]!==i?({children:n,FallbackComponent:o,uploads:d,...t}=i,e[0]=i,e[1]=o,e[2]=n,e[3]=t,e[4]=d):(o=e[1],n=e[2],t=e[3],d=e[4]);let f=d===void 0?!1:d,{config:p}=X(),{collections:l}=p,{user:c}=Q(),{visibleEntities:u}=Y(),a;e[5]!==l||e[6]!==f||e[7]!==c||e[8]!==u?(a=()=>Z(l,{uploads:f,user:c,visibleEntities:u}).map(ee),e[5]=l,e[6]=f,e[7]=c,e[8]=u,e[9]=a):a=e[9];let[s]=D.useState(a);if(!s.length){let r;return e[10]!==o||e[11]!==t?(r=o?K(o,{...t}):null,e[10]=o,e[11]=t,e[12]=r):r=e[12],r}let m;if(e[13]!==n||e[14]!==s||e[15]!==t){let r;e[17]!==s||e[18]!==t?(r={...t,enabledCollectionSlugs:s},e[17]=s,e[18]=t,e[19]=r):r=e[19],m=D.cloneElement(n,r),e[13]=n,e[14]=s,e[15]=t,e[16]=m}else m=e[16];return m};function ee(i){let{slug:e}=i;return e}import{createCommand as te}from"lexical";var Re=te("INSERT_UPLOAD_WITH_DRAWER_COMMAND");export{Ce as a,we as b,Re as c};
//# sourceMappingURL=chunk-FSKAVN4P.js.map
