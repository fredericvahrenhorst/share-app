var st=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";import{c as ae}from"react/compiler-runtime";import{useRef as le}from"react";function Xn(o){let t=ae(2),e=o===void 0?500:o,r=le(void 0),n;return t[0]!==e?(n=s=>new Promise(i=>{let a=()=>{s(),i()};"requestIdleCallback"in window?("cancelIdleCallback"in window&&r.current!==void 0&&cancelIdleCallback(r.current),r.current=requestIdleCallback(a,{timeout:e})):fe().then(a)}),t[0]=e,t[1]=n):n=t[1],n}function fe(){return new Promise(o=>{setTimeout(o,100),requestAnimationFrame(()=>{setTimeout(o,0)})})}var Q=class{_x;_y;constructor(t,e){this._x=t,this._y=e}calcDeltaXTo({x:t}){return this.x-t}calcDeltaYTo({y:t}){return this.y-t}calcDistanceTo(t){return Math.sqrt(Math.pow(this.calcDeltaXTo(t),2)+Math.pow(this.calcDeltaYTo(t),2))}calcHorizontalDistanceTo(t){return Math.abs(this.calcDeltaXTo(t))}calcVerticalDistance(t){return Math.abs(this.calcDeltaYTo(t))}equals({x:t,y:e}){return this.x===t&&this.y===e}get x(){return this._x}get y(){return this._y}};function ct(o){return o instanceof Q}import{c as be}from"react/compiler-runtime";import{jsx as Oe}from"react/jsx-runtime";import{useLexicalComposerContext as ke}from"@lexical/react/LexicalComposerContext.js";import{mergeRegister as Ae}from"@lexical/utils";import{$getSelection as V,$isRangeSelection as Z,$isTextNode as Me,COMMAND_PRIORITY_LOW as $e,createCommand as Le,getDOMSelection as De}from"lexical";import{useEffect as xt,useState as Be}from"react";import*as j from"react";import{c as dt}from"react/compiler-runtime";import{useLexicalComposerContext as mt}from"@lexical/react/LexicalComposerContext.js";import{mergeRegister as at}from"@lexical/utils";import{$getSelection as gt,$isRangeSelection as ue,$setSelection as de,COMMAND_PRIORITY_LOW as A,createCommand as me,KEY_ARROW_DOWN_COMMAND as ge,KEY_ARROW_UP_COMMAND as pe,KEY_ENTER_COMMAND as he,KEY_ESCAPE_COMMAND as xe,KEY_TAB_COMMAND as Ee}from"lexical";import{useCallback as q,useEffect as M,useLayoutEffect as _e,useMemo as Te,useRef as Se,useState as we}from"react";var Ce="slash-menu-popup",lt=o=>{let t=document.getElementById("slash-menu");if(!t)return;let e=t.getBoundingClientRect();e.top+e.height>window.innerHeight&&t.scrollIntoView({block:"center"}),e.top<0&&t.scrollIntoView({block:"center"}),o.scrollIntoView({block:"nearest"})};function Re(o,t,e){let r=e;for(let n=r;n<=t.length;n++)o.substring(o.length-n)===t.substring(0,n)&&(r=n);return r}function Fe(o){let t=gt();if(!ue(t)||!t.isCollapsed())return;let e=t.anchor;if(e.type!=="text")return;let r=e.getNode();if(!r.isSimpleText())return;let n=e.offset,c=r.getTextContent().slice(0,n),s=o.replaceableString.length,i=Re(c,o.matchingString,s),a=n-i;if(a<0)return;let f;return a===0?[f]=r.splitText(n):[,f]=r.splitText(a,n),f}function Ie(o,t){let e=getComputedStyle(o),r=e.position==="absolute",n=t?/(auto|scroll|hidden)/:/(auto|scroll)/;if(e.position==="fixed")return document.body;for(let c=o;c=c.parentElement;)if(e=getComputedStyle(c),!(r&&e.position==="static")&&n.test(e.overflow+e.overflowY+e.overflowX))return c;return document.body}function ft(o,t){let e=o.getBoundingClientRect(),r=t.getBoundingClientRect();return e.top>r.top&&e.top<r.bottom}function Ne(o,t,e,r){let n=dt(12),[c]=mt(),s;n[0]!==c||n[1]!==e||n[2]!==r||n[3]!==o||n[4]!==t.current?(s=()=>{let a=t.current;if(a!=null&&o!=null){let f=c.getRootElement(),l=f!=null?Ie(f,!1):document.body,m=!1,g=ft(a,l),p=function(){m||(window.requestAnimationFrame(function(){e(),m=!1}),m=!0);let u=ft(a,l);u!==g&&(g=u,r?.(u))},d=new ResizeObserver(e);return window.addEventListener("resize",e),document.addEventListener("scroll",p,{capture:!0,passive:!0}),d.observe(a),()=>{d.disconnect(),window.removeEventListener("resize",e),document.removeEventListener("scroll",p,!0)}}},n[0]=c,n[1]=e,n[2]=r,n[3]=o,n[4]=t.current,n[5]=s):s=n[5];let i;n[6]!==c||n[7]!==e||n[8]!==r||n[9]!==o||n[10]!==t?(i=[c,r,e,o,t],n[6]=c,n[7]=e,n[8]=r,n[9]=o,n[10]=t,n[11]=i):i=n[11],M(s,i)}var ut=me("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function pt({anchorElementRef:o,close:t,editor:e,groups:r,menuRenderFn:n,resolution:c,shouldSplitNodeWithQuery:s=!1}){let[i,a]=we(null),f=c.match&&c.match.matchingString||"",l=q(d=>{let u=e.getRootElement();u!==null&&(u.setAttribute("aria-activedescendant",`${Ce}__item-${d.key}`),a(d.key))},[e]),m=q(()=>{if(r!==null&&f!=null){let d=r.flatMap(u=>u.items);if(d.length){let u=d[0];l(u)}}},[r,l,f]);M(()=>{m()},[f,m]);let g=q(d=>{t(),e.update(()=>{let u=c.match!=null&&s?Fe(c.match):null;u&&u.remove()}),setTimeout(()=>{let u;e.read(()=>{u=gt()?.clone()}),e.update(()=>{u&&de(u)}),d.onSelect({editor:e,queryString:c.match?c.match.matchingString:""})},0)},[e,s,c.match,t]);M(()=>()=>{let d=e.getRootElement();d!==null&&d.removeAttribute("aria-activedescendant")},[e]),_e(()=>{r===null?a(null):i===null&&m()},[r,i,l,m]),M(()=>at(e.registerCommand(ut,({item:d})=>d.ref&&d.ref.current!=null?(lt(d.ref.current),!0):!1,A)),[e,l]),M(()=>at(e.registerCommand(ge,d=>{let u=d;if(r!==null&&r.length&&i!==null){let x=r.flatMap(T=>T.items),h=x.findIndex(T=>T.key===i),E=h!==x.length-1?h+1:0,_=x[E];if(!_)return!1;l(_),_.ref!=null&&_.ref.current&&e.dispatchCommand(ut,{index:E,item:_}),u.preventDefault(),u.stopImmediatePropagation()}return!0},A),e.registerCommand(pe,d=>{let u=d;if(r!==null&&r.length&&i!==null){let x=r.flatMap(T=>T.items),h=x.findIndex(T=>T.key===i),E=h!==0?h-1:x.length-1,_=x[E];if(!_)return!1;l(_),_.ref!=null&&_.ref.current&&lt(_.ref.current),u.preventDefault(),u.stopImmediatePropagation()}return!0},A),e.registerCommand(xe,d=>{let u=d;return u.preventDefault(),u.stopImmediatePropagation(),t(),!0},A),e.registerCommand(Ee,d=>{let u=d;if(r===null||i===null)return!1;let h=r.flatMap(E=>E.items).find(E=>E.key===i);return h?(u.preventDefault(),u.stopImmediatePropagation(),g(h),!0):!1},A),e.registerCommand(he,d=>{if(r===null||i===null)return!1;let x=r.flatMap(h=>h.items).find(h=>h.key===i);return x?(d!==null&&(d.preventDefault(),d.stopImmediatePropagation()),g(x),!0):!1},A)),[g,t,e,r,i,l]);let p=Te(()=>({groups:r,selectedItemKey:i,selectItemAndCleanUp:g,setSelectedItemKey:a}),[g,i,r]);return n(o,p,c.match?c.match.matchingString:"")}function ye(o,t){t!=null&&(o.className=t),o.setAttribute("aria-label","Slash menu"),o.setAttribute("role","listbox"),o.style.display="block",o.style.position="absolute"}function ht(o,t,e,r){let n=dt(14),[c]=mt(),s;n[0]===Symbol.for("react.memo_cache_sentinel")?(s=st?document.createElement("div"):null,n[0]=s):s=n[0];let i=Se(s),a;n[1]!==o||n[2]!==r||n[3]!==c||n[4]!==t?(a=()=>{if(i.current===null||parent===void 0)return;let d=c.getRootElement(),u=i.current,x=u.firstChild;if(d!==null&&t!==null){let{height:h,width:E}=t.getRect(),{left:_,top:T}=t.getRect(),I=T;if(T=T-(o.getBoundingClientRect().top+window.scrollY),_=_-(o.getBoundingClientRect().left+window.scrollX),u.style.left=`${_+window.scrollX}px`,u.style.height=`${h}px`,u.style.width=`${E}px`,x!==null){let S=x.getBoundingClientRect(),F=S.height,w=S.width,N=d.getBoundingClientRect();_+w>N.right&&(u.style.left=`${N.right-w+window.scrollX}px`);let y=I+F+32>window.innerHeight,O=I<0;y&&!O?u.style.top=`${T+32-F+window.scrollY-(h+24)}px`:u.style.top=`${T+window.scrollY+32}px`}u.isConnected||(ye(u,r),o.append(u)),u.setAttribute("id","slash-menu"),i.current=u,d.setAttribute("aria-controls","slash-menu")}},n[1]=o,n[2]=r,n[3]=c,n[4]=t,n[5]=a):a=n[5];let f=a,l,m;n[6]!==c||n[7]!==f||n[8]!==t?(l=()=>{let d=c.getRootElement();if(t!==null)return f(),()=>{d!==null&&d.removeAttribute("aria-controls");let u=i.current;u!==null&&u.isConnected&&(u.remove(),u.removeAttribute("id"))}},m=[c,f,t],n[6]=c,n[7]=f,n[8]=t,n[9]=l,n[10]=m):(l=n[9],m=n[10]),M(l,m);let g;return n[11]!==t||n[12]!==e?(g=d=>{t!==null&&(d||e(null))},n[11]=t,n[12]=e,n[13]=g):g=n[13],Ne(t,i,f,g),i}var lo=`\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'"~=<>_:;`;function Pe(o){let t=o.anchor;if(t.type!=="text")return null;let e=t.getNode();if(!e.isSimpleText())return null;let r=t.offset;return e.getTextContent().slice(0,r)}function Et(o,t,e){let r=De(e);if(r===null||!r.isCollapsed)return!1;let n=r.anchorNode,c=o,s=r.anchorOffset;if(n==null||s==null)return!1;try{t.setStart(n,c),t.setEnd(n,s>1?s:1)}catch{return!1}return!0}function ve(o){let t;return o.getEditorState().read(()=>{let e=V();Z(e)&&(t=Pe(e))}),t}function _t(o,t){return t!==0?!1:o.getEditorState().read(()=>{let e=V();if(Z(e)){let c=e.anchor.getNode().getPreviousSibling();return Me(c)&&c.isTextEntity()}return!1})}function Tt(o){j.startTransition?j.startTransition(o):o()}var He=Le("ENABLE_SLASH_MENU_COMMAND");function fo(o){let t=be(30),{anchorClassName:e,anchorElem:r,groups:n,menuRenderFn:c,onClose:s,onOpen:i,onQueryChange:a,triggerFn:f}=o,[l]=ke(),[m,g]=Be(null),p=ht(r,m,g,e),d;t[0]!==s||t[1]!==m?(d=()=>{g(null),s!=null&&m!==null&&s()},t[0]=s,t[1]=m,t[2]=d):d=t[2];let u=d,x;t[3]!==i||t[4]!==m?(x=F=>{g(F),i!=null&&m===null&&i(F)},t[3]=i,t[4]=m,t[5]=x):x=t[5];let h=x,E,_;t[6]!==l||t[7]!==h?(E=()=>Ae(l.registerCommand(He,F=>{let{node:w}=F;return l.getEditorState().read(()=>{let N={leadOffset:0,matchingString:"",replaceableString:""};if(!_t(l,N.leadOffset)&&w!==null){let y=l._window??window,O=y.document.createRange();Et(N.leadOffset,O,y)!==null&&Tt(()=>h({getRect:()=>O.getBoundingClientRect(),match:N}));return}}),!0},$e)),_=[l,h],t[6]=l,t[7]=h,t[8]=E,t[9]=_):(E=t[8],_=t[9]),xt(E,_);let T;t[10]!==u||t[11]!==l||t[12]!==a||t[13]!==h||t[14]!==f?(T=()=>{let F=()=>{l.getEditorState().read(()=>{let N=l._window??window,y=N.document.createRange(),O=V(),W=ve(l);if(!Z(O)||!O.isCollapsed()||W===void 0||y===null){u();return}let k=f({editor:l,query:W});if(a(k?k.matchingString:null),k!==null&&!_t(l,k.leadOffset)&&Et(k.leadOffset,y,N)!==null){Tt(()=>h({getRect:()=>y.getBoundingClientRect(),match:k}));return}u()})},w=l.registerUpdateListener(F);return()=>{w()}},t[10]=u,t[11]=l,t[12]=a,t[13]=h,t[14]=f,t[15]=T):T=t[15];let I;t[16]!==u||t[17]!==l||t[18]!==a||t[19]!==h||t[20]!==m||t[21]!==f?(I=[l,f,a,m,u,h],t[16]=u,t[17]=l,t[18]=a,t[19]=h,t[20]=m,t[21]=f,t[22]=I):I=t[22],xt(T,I);let S;return t[23]!==p||t[24]!==u||t[25]!==l||t[26]!==n||t[27]!==c||t[28]!==m?(S=p.current===null||m===null||l===null?null:Oe(pt,{anchorElementRef:p,close:u,editor:l,groups:n,menuRenderFn:c,resolution:m,shouldSplitNodeWithQuery:!0}),t[23]=p,t[24]=u,t[25]=l,t[26]=n,t[27]=c,t[28]=m,t[29]=S):S=t[29],S}var St=class o{_bottom;_left;_right;_top;constructor(t,e,r,n){let[c,s]=e<=n?[e,n]:[n,e],[i,a]=t<=r?[t,r]:[r,t];this._top=c,this._right=a,this._left=i,this._bottom=s}static fromDOM(t){let{height:e,left:r,top:n,width:c}=t.getBoundingClientRect();return o.fromLWTH(r,c,n,e)}static fromDOMRect(t){let{height:e,left:r,top:n,width:c}=t;return o.fromLWTH(r,c,n,e)}static fromLTRB(t,e,r,n){return new o(t,e,r,n)}static fromLWTH(t,e,r,n){return new o(t,r,t+e,r+n)}static fromPoints(t,e){let{x:r,y:n}=t,{x:c,y:s}=e;return o.fromLTRB(r,n,c,s)}contains(t){if(ct(t)){let{x:s,y:i}=t,a=i<this._top,f=i>this._bottom,l=s<this._left,m=s>this._right;return{reason:{isOnBottomSide:f,isOnLeftSide:l,isOnRightSide:m,isOnTopSide:a},result:!a&&!f&&!l&&!m}}let{bottom:e,left:r,right:n,top:c}=t;return c>=this._top&&c<=this._bottom&&e>=this._top&&e<=this._bottom&&r>=this._left&&r<=this._right&&n>=this._left&&n<=this._right}distanceFromPoint(t){let e=this.contains(t);if(e.result)return{distance:0,isOnBottomSide:e.reason.isOnBottomSide,isOnLeftSide:e.reason.isOnLeftSide,isOnRightSide:e.reason.isOnRightSide,isOnTopSide:e.reason.isOnTopSide};let r=0,n=0;return t.x<this._left?r=this._left-t.x:t.x>this._right&&(r=t.x-this._right),t.y<this._top?n=this._top-t.y:t.y>this._bottom&&(n=t.y-this._bottom),{distance:Math.sqrt(r*r+n*n),isOnBottomSide:t.y>this._bottom,isOnLeftSide:t.x<this._left,isOnRightSide:t.x>this._right,isOnTopSide:t.y<this._top}}equals({bottom:t,left:e,right:r,top:n}){return n===this._top&&t===this._bottom&&e===this._left&&r===this._right}generateNewRect({bottom:t=this.bottom,left:e=this.left,right:r=this.right,top:n=this.top}){return new o(e,n,r,t)}intersectsWith(t){let{height:e,left:r,top:n,width:c}=t,{height:s,left:i,top:a,width:f}=this,l=r+c>=i+f?r+c:i+f,m=n+e>=a+s?n+e:a+s,g=r<=i?r:i,p=n<=a?n:a;return l-g<=c+f&&m-p<=e+s}get bottom(){return this._bottom}get height(){return Math.abs(this._bottom-this._top)}get left(){return this._left}get right(){return this._right}get top(){return this._top}get width(){return Math.abs(this._left-this._right)}};function po({editorConfig:o}){return Ke({nodes:o.features.nodes})}function Ke({nodes:o}){return o.map(t=>"node"in t?t.node:t)}import{$getRoot as je,$isDecoratorNode as It,$isElementNode as U,$isLineBreakNode as Ve,$isTextNode as G}from"lexical";import{$isListItemNode as Ue,$isListNode as wt}from"@lexical/list";import{$isHeadingNode as Ge,$isQuoteNode as ze}from"@lexical/rich-text";import{$isParagraphNode as Xe,$isTextNode as Ye}from"lexical";var C={markdownFormatKind:null,regEx:/(?:)/,regExForAutoFormatting:/(?:)/,requiresParagraphStart:!1},R={...C,requiresParagraphStart:!0},To={...R,export:$(1),markdownFormatKind:"paragraphH1",regEx:/^# /,regExForAutoFormatting:/^# /},So={...R,export:$(2),markdownFormatKind:"paragraphH2",regEx:/^## /,regExForAutoFormatting:/^## /},wo={...R,export:$(3),markdownFormatKind:"paragraphH3",regEx:/^### /,regExForAutoFormatting:/^### /},Co={...R,export:$(4),markdownFormatKind:"paragraphH4",regEx:/^#### /,regExForAutoFormatting:/^#### /},Ro={...R,export:$(5),markdownFormatKind:"paragraphH5",regEx:/^##### /,regExForAutoFormatting:/^##### /},Fo={...R,export:$(6),markdownFormatKind:"paragraphH6",regEx:/^###### /,regExForAutoFormatting:/^###### /},Io={...R,export:Qe,markdownFormatKind:"paragraphBlockQuote",regEx:/^> /,regExForAutoFormatting:/^> /},No={...R,export:J,markdownFormatKind:"paragraphUnorderedList",regEx:/^(\s{0,10})- /,regExForAutoFormatting:/^(\s{0,10})- /},yo={...R,export:J,markdownFormatKind:"paragraphUnorderedList",regEx:/^(\s{0,10})\* /,regExForAutoFormatting:/^(\s{0,10})\* /},bo={...R,export:J,markdownFormatKind:"paragraphOrderedList",regEx:/^(\s{0,10})(\d+)\.\s/,regExForAutoFormatting:/^(\s{0,10})(\d+)\.\s/},Oo={...R,markdownFormatKind:"horizontalRule",regEx:/^\*\*\*$/,regExForAutoFormatting:/^\*\*\* /},ko={...R,markdownFormatKind:"horizontalRule",regEx:/^---$/,regExForAutoFormatting:/^--- /},Ao={...C,exportFormat:"code",exportTag:"`",markdownFormatKind:"code",regEx:/(`)(\s*)([^`]*)(\s*)(`)()/,regExForAutoFormatting:/(`)(\s*\b)([^`]*)(\b\s*)(`)(\s)$/},Mo={...C,exportFormat:"bold",exportTag:"**",markdownFormatKind:"bold",regEx:/(\*\*)(\s*)([^*]*)(\s*)(\*\*)()/,regExForAutoFormatting:/(\*\*)(\s*\b)([^*]*)(\b\s*)(\*\*)(\s)$/},$o={...C,exportFormat:"italic",exportTag:"*",markdownFormatKind:"italic",regEx:/(\*)(\s*)([^*]*)(\s*)(\*)()/,regExForAutoFormatting:/(\*)(\s*\b)([^*]*)(\b\s*)(\*)(\s)$/},Lo={...C,exportFormat:"bold",exportTag:"_",markdownFormatKind:"bold",regEx:/(__)(\s*)([^_]*)(\s*)(__)()/,regExForAutoFormatting:/(__)(\s*)([^_]*)(\s*)(__)(\s)$/},Do={...C,exportFormat:"italic",exportTag:"_",markdownFormatKind:"italic",regEx:/(_)()([^_]*)()(_)()/,regExForAutoFormatting:/(_)()([^_]*)()(_)(\s)$/},Bo={...C,exportFormat:"underline",exportTag:"<u>",exportTagClose:"</u>",markdownFormatKind:"underline",regEx:/(<u>)(\s*)([^<]*)(\s*)(<\/u>)()/,regExForAutoFormatting:/(<u>)(\s*\b)([^<]*)(\b\s*)(<\/u>)(\s)$/},Po={...C,exportFormat:"strikethrough",exportTag:"~~",markdownFormatKind:"strikethrough",regEx:/(~~)(\s*)([^~]*)(\s*)(~~)()/,regExForAutoFormatting:/(~~)(\s*\b)([^~]*)(\b\s*)(~~)(\s)$/},vo={...C,markdownFormatKind:"strikethrough_italic_bold",regEx:/(~~_\*\*)(\s*\b)([^*_~]+)(\b\s*)(\*\*_~~)()/,regExForAutoFormatting:/(~~_\*\*)(\s*\b)([^*_~]+)(\b\s*)(\*\*_~~)(\s)$/},Ho={...C,markdownFormatKind:"italic_bold",regEx:/(_\*\*)(\s*\b)([^*_]+)(\b\s*)(\*\*_)/,regExForAutoFormatting:/(_\*\*)(\s*\b)([^*_]+)(\b\s*)(\*\*_)(\s)$/},Ko={...C,markdownFormatKind:"strikethrough_italic",regEx:/(~~_)(\s*)([^_~]+)(\s*)(_~~)/,regExForAutoFormatting:/(~~_)(\s*)([^_~]+)(\s*)(_~~)(\s)$/},Uo={...C,markdownFormatKind:"strikethrough_bold",regEx:/(~~\*\*)(\s*\b)([^*~]+)(\b\s*)(\*\*~~)/,regExForAutoFormatting:/(~~\*\*)(\s*\b)([^*~]+)(\b\s*)(\*\*~~)(\s)$/},Go={...C,markdownFormatKind:"link",regEx:/(\[)([^\]]*)(\]\()([^)]*)(\)*)()/,regExForAutoFormatting:/(\[)([^\]]*)(\]\()([^)]*)(\)*)(\s)$/};function $(o){return(t,e)=>Ge(t)&&t.getTag()==="h"+o?"#".repeat(o)+" "+e(t):null}function J(o,t){return wt(o)?Ct(o,t,0):null}var We=4;function Ct(o,t,e){let r=[],n=o.getChildren(),c=0;for(let s of n)if(Ue(s)){if(s.getChildrenSize()===1){let f=s.getFirstChild();if(wt(f)){r.push(Ct(f,t,e+1));continue}}let i=" ".repeat(e*We),a=o.getListType()==="bullet"?"- ":`${o.getStart()+c}. `;r.push(i+a+t(s)),c++}return r.join(`
`)}function Qe(o,t){return ze(o)?"> "+t(o):null}function H(o,t){let e={};for(let r of o){let n=t(r);n&&(e[n]?e[n].push(r):e[n]=[r])}return e}function L(o){let t=H(o,e=>e.type);return{element:t.element||[],multilineElement:t["multiline-element"]||[],textFormat:t["text-format"]||[],textMatch:t["text-match"]||[]}}var D=/[!-/:-@[-`{-~\s]/,qe=/^\s{0,3}$/;function v(o){if(!Xe(o))return!1;let t=o.getFirstChild();return t==null||o.getChildrenSize()===1&&Ye(t)&&qe.test(t.getTextContent())}function Nt(o,t=!1){let e=L(o),r=[...e.multilineElement,...e.element],n=!t,c=e.textFormat.filter(s=>s.format.length===1).sort((s,i)=>s.format.includes("code")&&!i.format.includes("code")?1:!s.format.includes("code")&&i.format.includes("code")?-1:0);return s=>{let i=[],a=(s||je()).getChildren();return a.forEach((f,l)=>{let m=Ze(f,r,c,e.textMatch);m!=null&&i.push(n&&l>0&&!v(f)&&!v(a[l-1])?`
`.concat(m):m)}),i.join(`
`)}}function Ze(o,t,e,r){for(let n of t){if(!n.export)continue;let c=n.export(o,s=>z(s,e,r));if(c!=null)return c}return U(o)?z(o,e,r):It(o)?o.getTextContent():null}function z(o,t,e,r,n){let c=[],s=o.getChildren();r||(r=[]),n||(n=[]);t:for(let i of s){for(let a of e){if(!a.export)continue;let f=a.export(i,l=>z(l,t,e,r,[...n,...r]),(l,m)=>Rt(l,m,t,r,n));if(f!=null){c.push(f);continue t}}Ve(i)?c.push(`
`):G(i)?c.push(Rt(i,i.getTextContent(),t,r,n)):U(i)?c.push(z(i,t,e,r,n)):It(i)&&c.push(i.getTextContent())}return c.join("")}function Rt(o,t,e,r,n){let c=t.trim(),s=c;o.hasFormat("code")||(s=s.replace(/([*_`~\\])/g,"\\$1"));let i="",a="",f="",l=Ft(o,!0),m=Ft(o,!1),g=new Set;for(let p of e){let d=p.format[0],u=p.tag;K(o,d)&&!g.has(d)&&(g.add(d),(!K(l,d)||!r.find(x=>x.tag===u))&&(r.push({format:d,tag:u}),i+=u))}for(let p=0;p<r.length;p++){let d=r[p],u=K(o,d.format),x=K(m,d.format);if(u&&x)continue;let h=[...r];for(;h.length>p;){let E=h.pop();n&&E&&n.find(_=>_.tag===E.tag)||(E&&typeof E.tag=="string"&&(u?x||(f+=E.tag):a+=E.tag),r.pop())}break}return s=i+s+f,a+t.replace(c,()=>s)}function Ft(o,t){let e=t?o.getPreviousSibling():o.getNextSibling();if(!e){let r=o.getParentOrThrow();r.isInline()&&(e=t?r.getPreviousSibling():r.getNextSibling())}for(;e;){if(U(e)){if(!e.isInline())break;let r=t?e.getLastDescendant():e.getFirstDescendant();if(G(r))return r;e=t?e.getPreviousSibling():e.getNextSibling()}if(G(e))return e;if(!U(e))return null}return null}function K(o,t){return G(o)&&o.hasFormat(t)}import{$isListItemNode as tn,$isListNode as At}from"@lexical/list";import{$isQuoteNode as en}from"@lexical/rich-text";import{$findMatchingParent as nn}from"@lexical/utils";import{$createLineBreakNode as on,$createParagraphNode as rn,$createTextNode as sn,$getRoot as cn,$getSelection as an,$isParagraphNode as ln}from"lexical";import{$isTextNode as B}from"lexical";function yt(o,t){let e=o.getTextContent(),r=Je(e,t);if(!r)return null;let n=r.index||0,c=n+r[0].length,s=t.transformersByTag[r[1]];return{endIndex:c,match:r,startIndex:n,transformer:s}}function Je(o,t){let e=o.match(t.openTagsRegExp);if(e==null)return null;for(let r of e){let n=r.replace(/^\s/,""),c=t.fullMatchRegExpByTag[n];if(c==null)continue;let s=o.match(c),i=t.transformersByTag[n];if(s!=null&&i!=null){if(i.intraword!==!1)return s;let{index:a=0}=s,f=o[a-1],l=o[a+s[0].length];if((!f||D.test(f))&&(!l||D.test(l)))return s}}return null}function bt(o,t,e,r,n){let c=o.getTextContent(),s,i,a;if(n[0]===c?a=o:t===0?[a,s]=o.splitText(e):[i,a,s]=o.splitText(t,e),a.setTextContent(n[2]),r)for(let f of r.format)a.hasFormat(f)||a.toggleFormat(f);return{nodeAfter:s,nodeBefore:i,transformedNode:a}}function Ot(o,t){let e=o,r,n,c,s;for(let i of t){if(!i.replace||!i.importRegExp)continue;let a=e.getTextContent().match(i.importRegExp);if(!a)continue;let f=a.index||0,l=i.getEndIndex?i.getEndIndex(e,a):f+a[0].length;l!==!1&&(r===void 0||n===void 0||f<r&&l>n)&&(r=f,n=l,c=i,s=a)}return r===void 0||n===void 0||c===void 0||s===void 0?null:{endIndex:n,match:s,startIndex:r,transformer:c}}function kt(o,t,e,r,n){let c,s,i;if(t===0?[i,c]=o.splitText(e):[s,i,c]=o.splitText(t,e),!r.replace)return null;let a=i?r.replace(i,n):void 0;return{nodeAfter:c,nodeBefore:s,transformedNode:a||void 0}}function b(o,t,e){let r=yt(o,t),n=Ot(o,e);if(r&&n&&(r.startIndex<=n.startIndex&&r.endIndex>=n.endIndex?n=null:r=null),r){let i=bt(o,r.startIndex,r.endIndex,r.transformer,r.match);i.nodeAfter&&B(i.nodeAfter)&&!i.nodeAfter.hasFormat("code")&&b(i.nodeAfter,t,e),i.nodeBefore&&B(i.nodeBefore)&&!i.nodeBefore.hasFormat("code")&&b(i.nodeBefore,t,e),i.transformedNode&&B(i.transformedNode)&&!i.transformedNode.hasFormat("code")&&b(i.transformedNode,t,e)}else if(n){let i=kt(o,n.startIndex,n.endIndex,n.transformer,n.match);if(!i)return;i.nodeAfter&&B(i.nodeAfter)&&!i.nodeAfter.hasFormat("code")&&b(i.nodeAfter,t,e),i.nodeBefore&&B(i.nodeBefore)&&!i.nodeBefore.hasFormat("code")&&b(i.nodeBefore,t,e),i.transformedNode&&B(i.transformedNode)&&!i.transformedNode.hasFormat("code")&&b(i.transformedNode,t,e)}let s=o.getTextContent().replace(/\\([*_`~])/g,"$1");o.setTextContent(s)}function Mt(o,t=!1){let e=L(o),r=dn(e.textFormat);return(n,c)=>{let s=n.split(`
`),i=s.length,a=c||cn();a.clear();for(let l=0;l<i;l++){let m=s[l],[g,p]=fn(s,l,e.multilineElement,a);if(g){l=p;continue}un(m,a,e.element,r,e.textMatch)}let f=a.getChildren();for(let l of f)!t&&v(l)&&a.getChildrenSize()>1&&l.remove();an()!==null&&a.selectStart()}}function fn(o,t,e,r){for(let n of e){let{handleImportAfterStartMatch:c,regExpEnd:s,regExpStart:i,replace:a}=n,f=o[t]?.match(i);if(!f)continue;if(c){let d=c({lines:o,rootNode:r,startLineIndex:t,startMatch:f,transformer:n});if(d===null)continue;if(d)return d}let l=typeof s=="object"&&"regExp"in s?s.regExp:s,m=s&&typeof s=="object"&&"optional"in s?s.optional:!s,g=t,p=o.length;for(;g<p;){let d=l?o[g]?.match(l):null;if(!d&&(!m||m&&g<p-1)){g++;continue}if(d&&t===g&&d.index===f.index){g++;continue}let u=[];if(d&&t===g)u.push(o[t].slice(f[0].length,-d[0].length));else for(let x=t;x<=g;x++){let h=o[x];if(x===t){let E=h.slice(f[0].length);u.push(E)}else if(x===g&&d){let E=h.slice(0,-d[0].length);u.push(E)}else u.push(h)}if(a(r,null,f,d,u,!0)!==!1)return[!0,g];break}}return[!1,t]}function un(o,t,e,r,n){let c=sn(o),s=rn();s.append(c),t.append(s);for(let{regExp:i,replace:a}of e){let f=o.match(i);if(f&&(c.setTextContent(o.slice(f[0].length)),a(s,[c],f,!0)!==!1))break}if(b(c,r,n),s.isAttached()&&o.length>0){let i=s.getPreviousSibling();if(ln(i)||en(i)||At(i)){let a=i;if(At(i)){let f=i.getLastDescendant();f==null?a=null:a=nn(f,tn)}a!=null&&a.getTextContentSize()>0&&(a.splice(a.getChildrenSize(),0,[on(),...s.getChildren()]),s.remove())}}}function dn(o){let t={},e={},r=[],n="(?<![\\\\])";for(let c of o){let{tag:s}=c;t[s]=c;let i=s.replace(/([*^+])/g,"\\$1");r.push(i),s.length===1?e[s]=new RegExp(`(?<![\\\\${i}])(${i})((\\\\${i})?.*?[^${i}\\s](\\\\${i})?)((?<!\\\\)|(?<=\\\\\\\\))(${i})(?![\\\\${i}])`):e[s]=new RegExp(`(?<!\\\\)(${i})((\\\\${i})?.*?[^\\s](\\\\${i})?)((?<!\\\\)|(?<=\\\\\\\\))(${i})(?!\\\\)`)}return{fullMatchRegExpByTag:e,openTagsRegExp:new RegExp(`${n}(${r.join("|")})`,"g"),transformersByTag:t}}import{$createRangeSelection as mn,$getSelection as tt,$isLineBreakNode as gn,$isRangeSelection as et,$isRootOrShadowRoot as Lt,$isTextNode as Dt,$setSelection as pn}from"lexical";function hn(o,t,e,r){let n=o.getParent();if(!Lt(n)||o.getFirstChild()!==t)return!1;let c=t.getTextContent();if(c[e-1]!==" ")return!1;for(let{regExp:s,replace:i}of r){let a=c.match(s);if(a&&a[0].length===(a[0].endsWith(" ")?e:e-1)){let f=t.getNextSiblings(),[l,m]=t.splitText(e);l?.remove();let g=m?[m,...f]:f;if(i(o,g,a,!1)!==!1)return!0}}return!1}function xn(o,t,e,r){let n=o.getParent();if(!Lt(n)||o.getFirstChild()!==t)return!1;let c=t.getTextContent();if(c[e-1]!==" ")return!1;for(let{regExpEnd:s,regExpStart:i,replace:a}of r){if(s&&!("optional"in s)||s&&"optional"in s&&!s.optional)continue;let f=c.match(i);if(f&&f[0].length===(f[0].endsWith(" ")?e:e-1)){let l=t.getNextSiblings(),[m,g]=t.splitText(e);m?.remove();let p=g?[g,...l]:l;if(a(o,p,f,null,null,!1)!==!1)return!0}}return!1}function En(o,t,e){let r=o.getTextContent(),n=r[t-1],c=e[n];if(c==null)return!1;t<r.length&&(r=r.slice(0,t));for(let s of c){if(!s.replace||!s.regExp)continue;let i=r.match(s.regExp);if(i===null)continue;let a=i.index||0,f=a+i[0].length,l;return a===0?[l]=o.splitText(f):[,l]=o.splitText(a,f),l&&(l.selectNext(0,0),s.replace(l,i)),!0}return!1}function _n(o,t,e){let r=o.getTextContent(),n=t-1,c=r[n],s=e[c];if(!s)return!1;for(let i of s){let{tag:a}=i,f=a.length,l=n-f+1;if(f>1&&!Bt(r,l,a,0,f)||r[l-1]===" ")continue;let m=r[n+1];if(i.intraword===!1&&m&&!D.test(m))continue;let g=o,p=g,d=$t(r,l,a),u=p;for(;d<0&&(u=u.getPreviousSibling())&&!gn(u);)if(Dt(u)){let w=u.getTextContent();p=u,d=$t(w,w.length,a)}if(d<0||p===g&&d+f===l)continue;let x=p.getTextContent();if(d>0&&x[d-1]===c)continue;let h=x[d-1];if(i.intraword===!1&&h&&!D.test(h))continue;let E=g.getTextContent(),_=E.slice(0,l)+E.slice(n+1);g.setTextContent(_);let T=p===g?_:x;p.setTextContent(T.slice(0,d)+T.slice(d+f));let I=tt(),S=mn();pn(S);let F=n-f*(p===g?2:1)+1;S.anchor.set(p.__key,d,"text"),S.focus.set(g.__key,F,"text");for(let w of i.format)S.hasFormat(w)||S.formatText(w);S.anchor.set(S.focus.key,S.focus.offset,S.focus.type);for(let w of i.format)S.hasFormat(w)&&S.toggleFormat(w);return et(I)&&(S.format=I.format),!0}return!1}function $t(o,t,e){let r=e.length;for(let n=t;n>=r;n--){let c=n-r;if(Bt(o,c,e,0,r)&&o[c+r]!==" ")return c}return-1}function Bt(o,t,e,r,n){for(let c=0;c<n;c++)if(o[t+c]!==e[r+c])return!1;return!0}function ur(o,t=X){let e=L(t),r=H(e.textFormat,({tag:s})=>s[s.length-1]),n=H(e.textMatch,({trigger:s})=>s);for(let s of t){let i=s.type;if(i==="element"||i==="text-match"||i==="multiline-element"){let a=s.dependencies;for(let f of a)if(!o.hasNode(f))throw new Error("MarkdownShortcuts: missing dependency %s for transformer. Ensure node dependency is included in editor initial config."+f.getType())}}let c=(s,i,a)=>{hn(s,i,a,e.element)||xn(s,i,a,e.multilineElement)||En(i,a,n)||_n(i,a,r)};return o.registerUpdateListener(({dirtyLeaves:s,editorState:i,prevEditorState:a,tags:f})=>{if(f.has("collaboration")||f.has("historic")||o.isComposing())return;let l=i.read(tt),m=a.read(tt);if(!et(m)||!et(l)||!l.isCollapsed()||l.is(m))return;let g=l.anchor.key,p=l.anchor.offset,d=i._nodeMap.get(g);!Dt(d)||!s.has(g)||p!==1&&p>m.anchor.offset+1||o.update(()=>{if(d.hasFormat("code"))return;let u=d.getParent();u!==null&&c(u,d,l.anchor.offset)})})}import{$createListItemNode as Tn,$createListNode as Sn,$isListItemNode as wn,$isListNode as P,ListItemNode as ot,ListNode as rt}from"@lexical/list";import{$createHeadingNode as Cn,$createQuoteNode as Rn,$isHeadingNode as Fn,$isQuoteNode as Pt,HeadingNode as In,QuoteNode as Nn}from"@lexical/rich-text";import{$createLineBreakNode as yn}from"lexical";var vt=/^[\t ]*$/,Gt=/^(\s*)(\d+)\.\s/,zt=/^(\s*)[-*+]\s/,Xt=/^(\s*)(?:-\s)?\s?(\[(\s|x)?\])\s/i,nt=/^(#{1,6})\s/,Yt=/^>\s/,bn=/^[ \t]*(\\`\\`\\`|```)(\w+)?/,Ht=/[ \t]*(\\`\\`\\`|```)$/,On=/^[ \t]*```[^`]+(?:(?:`{1,2}|`{4,})[^`]+)*```(?:[^`]|$)/,kn=/^\|(.+)\|\s?$/,An=/^(\| ?:?-*:? ?)+\|\s?$/,Kt=/^[ \t]*<[a-z_][\w-]*(?:\s[^<>]*)?\/?>/i,Ut=/^[ \t]*<\/[a-z_][\w-]*\s*>/i,Mn=o=>(t,e,r)=>{let n=o(r);n.append(...e),t.replace(n),n.select(0,0)},Wt=4;function $n(o){let t=o.match(/\t/g),e=o.match(/ /g),r=0;return t&&(r+=t.length),e&&(r+=Math.floor(e.length/Wt)),r}var it=o=>(t,e,r)=>{let n=t.getPreviousSibling(),c=t.getNextSibling(),s=Tn(o==="check"?r[3]==="x":void 0);if(P(c)&&c.getListType()===o){let a=c.getFirstChild();a!==null?a.insertBefore(s):c.append(s),t.remove()}else if(P(n)&&n.getListType()===o)n.append(s),t.remove();else{let a=Sn(o,o==="number"?Number(r[2]):void 0);a.append(s),t.replace(a)}s.append(...e),s.select(0,0);let i=$n(r[1]);i&&s.setIndent(i)},Y=(o,t,e)=>{let r=[],n=o.getChildren(),c=0;for(let s of n)if(wn(s)){if(s.getChildrenSize()===1){let l=s.getFirstChild();if(P(l)){r.push(Y(l,t,e+1));continue}}let i=" ".repeat(e*Wt),a=o.getListType(),f=a==="number"?`${o.getStart()+c}. `:a==="check"?`- [${s.getChecked()?"x":" "}] `:"- ";r.push(i+f+t(s)),c++}return r.join(`
`)},Qt={type:"element",dependencies:[In],export:(o,t)=>{if(!Fn(o))return null;let e=Number(o.getTag().slice(1));return"#".repeat(e)+" "+t(o)},regExp:nt,replace:Mn(o=>{let t="h"+o[1].length;return Cn(t)})},qt={type:"element",dependencies:[Nn],export:(o,t)=>{if(!Pt(o))return null;let e=t(o).split(`
`),r=[];for(let n of e)r.push("> "+n);return r.join(`
`)},regExp:Yt,replace:(o,t,e,r)=>{if(r){let c=o.getPreviousSibling();if(Pt(c)){c.splice(c.getChildrenSize(),0,[yn(),...t]),c.select(0,0),o.remove();return}}let n=Rn();n.append(...t),o.replace(n),n.select(0,0)}},jt={type:"element",dependencies:[rt,ot],export:(o,t)=>P(o)?Y(o,t,0):null,regExp:zt,replace:it("bullet")},Ln={type:"element",dependencies:[rt,ot],export:(o,t)=>P(o)?Y(o,t,0):null,regExp:Xt,replace:it("check")},Vt={type:"element",dependencies:[rt,ot],export:(o,t)=>P(o)?Y(o,t,0):null,regExp:Gt,replace:it("number")},Zt={type:"text-format",format:["code"],tag:"`"},Jt={type:"text-format",format:["highlight"],tag:"=="},te={type:"text-format",format:["bold","italic"],tag:"***"},ee={type:"text-format",format:["bold","italic"],intraword:!1,tag:"___"},ne={type:"text-format",format:["bold"],tag:"**"},oe={type:"text-format",format:["bold"],intraword:!1,tag:"__"},re={type:"text-format",format:["strikethrough"],tag:"~~"},ie={type:"text-format",format:["italic"],tag:"*"},se={type:"text-format",format:["italic"],intraword:!1,tag:"_"};function ce(o,t){let e=o.split(`
`),r=!1,n=[],c=0;for(let s=0;s<e.length;s++){let i=e[s],a=n[n.length-1];if(On.test(i)){n.push(i);continue}if(Ht.test(i)){c===0&&(r=!0),c===1&&(r=!1),c>0&&c--,n.push(i);continue}if(bn.test(i)){r=!0,c++,n.push(i);continue}if(r){n.push(i);continue}vt.test(i)||vt.test(a)||!a||nt.test(a)||nt.test(i)||Yt.test(i)||Gt.test(i)||zt.test(i)||Xt.test(i)||kn.test(i)||An.test(i)||!t||Kt.test(i)||Ut.test(i)||Kt.test(a)||Ut.test(a)||Ht.test(a)?n.push(i):n[n.length-1]=a+" "+i.trim()}return n.join(`
`)}var Dn=[Qt,qt,jt,Vt],Bn=[],Pn=[Zt,te,ee,ne,oe,Jt,ie,se,re],vn=[],X=[...Dn,...Bn,...Pn,...vn];function Tr(o,t=X,e,r=!1,n=!0){let c=r?o:ce(o,n);return Mt(t,r)(c,e)}function Sr(o=X,t,e=!1){return Nt(o,e)(t)}export{st as a,Xn as b,ur as c,Tr as d,Sr as e,Q as f,ct as g,lo as h,He as i,fo as j,St as k,po as l};
//# sourceMappingURL=chunk-KZKGNMS3.js.map
