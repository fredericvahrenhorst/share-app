{"version":3,"file":"index.js","names":["useWindowInfo","getTranslation","validateWhereQuery","React","Fragment","useEffect","useRef","useState","Popup","PopupList","useUseTitleField","ChevronIcon","Dots","SearchIcon","useListQuery","useTranslation","AnimateHeight","ColumnSelector","Pill","SearchFilter","WhereBuilder","ActiveQueryPreset","getTextFieldsToBeSearched","useQueryPresets","baseClass","ListControls","props","beforeActions","collectionConfig","collectionSlug","disableQueryPresets","enableColumns","enableFilters","enableSort","listMenuItems","listMenuItemsFromProps","queryPreset","activePreset","queryPresetPermissions","renderedFilters","resolvedFilterOptions","handleSearchChange","query","CreateNewPresetDrawer","DeletePresetModal","EditPresetDrawer","hasModifiedPreset","openPresetListDrawer","PresetListDrawer","queryPresetMenuItems","resetPreset","titleField","i18n","t","breakpoints","s","smallBreak","searchLabel","label","name","listSearchableFields","admin","fields","searchLabelTranslated","hasWhereParam","Boolean","where","shouldInitializeWhereOpened","visibleDrawer","setVisibleDrawer","undefined","current","length","reduce","placeholderText","field","i","enableQueryPresets","_jsx","Divider","_jsxs","className","handleChange","searchQueryParam","search","icon","direction","onClick","pillStyle","size","Array","isArray","button","ariaLabel","horizontalAlign","id","verticalAlign","map","item","height","slug","collectionPluralLabel","labels","plural"],"sources":["../../../src/elements/ListControls/index.tsx"],"sourcesContent":["'use client'\n\nimport { useWindowInfo } from '@faceless-ui/window-info'\nimport { getTranslation } from '@payloadcms/translations'\nimport { validateWhereQuery } from 'payload/shared'\nimport React, { Fragment, useEffect, useRef, useState } from 'react'\n\nimport type { ListControlsProps } from './types.js'\n\nimport { Popup, PopupList } from '../../elements/Popup/index.js'\nimport { useUseTitleField } from '../../hooks/useUseAsTitle.js'\nimport { ChevronIcon } from '../../icons/Chevron/index.js'\nimport { Dots } from '../../icons/Dots/index.js'\nimport { SearchIcon } from '../../icons/Search/index.js'\nimport { useListQuery } from '../../providers/ListQuery/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { AnimateHeight } from '../AnimateHeight/index.js'\nimport { ColumnSelector } from '../ColumnSelector/index.js'\nimport { Pill } from '../Pill/index.js'\nimport { SearchFilter } from '../SearchFilter/index.js'\nimport { WhereBuilder } from '../WhereBuilder/index.js'\nimport { ActiveQueryPreset } from './ActiveQueryPreset/index.js'\nimport { getTextFieldsToBeSearched } from './getTextFieldsToBeSearched.js'\nimport { useQueryPresets } from './useQueryPresets.js'\nimport './index.scss'\n\nconst baseClass = 'list-controls'\n\n/**\n * The ListControls component is used to render the controls (search, filter, where)\n * for a collection's list view. You can find those directly above the table which lists\n * the collection's documents.\n */\nexport const ListControls: React.FC<ListControlsProps> = (props) => {\n  const {\n    beforeActions,\n    collectionConfig,\n    collectionSlug,\n    disableQueryPresets,\n    enableColumns = true,\n    enableFilters = true,\n    enableSort = false,\n    listMenuItems: listMenuItemsFromProps,\n    queryPreset: activePreset,\n    queryPresetPermissions,\n    renderedFilters,\n    resolvedFilterOptions,\n  } = props\n\n  const { handleSearchChange, query } = useListQuery()\n\n  const {\n    CreateNewPresetDrawer,\n    DeletePresetModal,\n    EditPresetDrawer,\n    hasModifiedPreset,\n    openPresetListDrawer,\n    PresetListDrawer,\n    queryPresetMenuItems,\n    resetPreset,\n  } = useQueryPresets({\n    activePreset,\n    collectionSlug,\n    queryPresetPermissions,\n  })\n\n  const titleField = useUseTitleField(collectionConfig)\n  const { i18n, t } = useTranslation()\n\n  const {\n    breakpoints: { s: smallBreak },\n  } = useWindowInfo()\n\n  const searchLabel =\n    (titleField &&\n      getTranslation(\n        'label' in titleField &&\n          (typeof titleField.label === 'string' || typeof titleField.label === 'object')\n          ? titleField.label\n          : 'name' in titleField\n            ? titleField.name\n            : null,\n        i18n,\n      )) ??\n    'ID'\n\n  const listSearchableFields = getTextFieldsToBeSearched(\n    collectionConfig.admin.listSearchableFields,\n    collectionConfig.fields,\n    i18n,\n  )\n\n  const searchLabelTranslated = useRef(\n    t('general:searchBy', { label: getTranslation(searchLabel, i18n) }),\n  )\n\n  const hasWhereParam = useRef(Boolean(query?.where))\n\n  const shouldInitializeWhereOpened = validateWhereQuery(query?.where)\n  const [visibleDrawer, setVisibleDrawer] = useState<'columns' | 'sort' | 'where'>(\n    shouldInitializeWhereOpened ? 'where' : undefined,\n  )\n\n  useEffect(() => {\n    if (hasWhereParam.current && !query?.where) {\n      hasWhereParam.current = false\n    } else if (query?.where) {\n      hasWhereParam.current = true\n    }\n  }, [setVisibleDrawer, query?.where])\n\n  useEffect(() => {\n    if (listSearchableFields?.length > 0) {\n      searchLabelTranslated.current = listSearchableFields.reduce(\n        (placeholderText: string, field, i: number) => {\n          const label =\n            'label' in field && field.label ? field.label : 'name' in field ? field.name : null\n\n          if (i === 0) {\n            return `${t('general:searchBy', {\n              label: getTranslation(label, i18n),\n            })}`\n          }\n\n          if (i === listSearchableFields.length - 1) {\n            return `${placeholderText} ${t('general:or')} ${getTranslation(label, i18n)}`\n          }\n\n          return `${placeholderText}, ${getTranslation(label, i18n)}`\n        },\n        '',\n      )\n    } else {\n      searchLabelTranslated.current = t('general:searchBy', {\n        label: getTranslation(searchLabel, i18n),\n      })\n    }\n  }, [t, listSearchableFields, i18n, searchLabel])\n\n  let listMenuItems: React.ReactNode[] = listMenuItemsFromProps\n\n  if (\n    collectionConfig?.enableQueryPresets &&\n    !disableQueryPresets &&\n    queryPresetMenuItems?.length > 0\n  ) {\n    // Cannot push or unshift into `listMenuItemsFromProps` as it will mutate the original array\n    listMenuItems = [\n      ...queryPresetMenuItems,\n      listMenuItemsFromProps?.length > 0 ? <PopupList.Divider key=\"divider\" /> : null,\n      ...(listMenuItemsFromProps || []),\n    ]\n  }\n\n  return (\n    <Fragment>\n      <div className={baseClass}>\n        <div className={`${baseClass}__wrap`}>\n          <SearchIcon />\n          <SearchFilter\n            handleChange={handleSearchChange}\n            key={collectionSlug}\n            // eslint-disable-next-line react-compiler/react-compiler -- TODO: fix\n            label={searchLabelTranslated.current}\n            searchQueryParam={query?.search}\n          />\n          {activePreset && hasModifiedPreset ? (\n            <div className={`${baseClass}__modified`}>Modified</div>\n          ) : null}\n          <div className={`${baseClass}__buttons`}>\n            <div className={`${baseClass}__buttons-wrap`}>\n              {!smallBreak && <React.Fragment>{beforeActions && beforeActions}</React.Fragment>}\n              {enableColumns && (\n                <Pill\n                  aria-controls={`${baseClass}-columns`}\n                  aria-expanded={visibleDrawer === 'columns'}\n                  className={`${baseClass}__toggle-columns`}\n                  icon={<ChevronIcon direction={visibleDrawer === 'columns' ? 'up' : 'down'} />}\n                  onClick={() =>\n                    setVisibleDrawer(visibleDrawer !== 'columns' ? 'columns' : undefined)\n                  }\n                  pillStyle=\"light\"\n                  size=\"small\"\n                >\n                  {t('general:columns')}\n                </Pill>\n              )}\n              {enableFilters && (\n                <Pill\n                  aria-controls={`${baseClass}-where`}\n                  aria-expanded={visibleDrawer === 'where'}\n                  className={`${baseClass}__toggle-where`}\n                  icon={<ChevronIcon direction={visibleDrawer === 'where' ? 'up' : 'down'} />}\n                  onClick={() => setVisibleDrawer(visibleDrawer !== 'where' ? 'where' : undefined)}\n                  pillStyle=\"light\"\n                  size=\"small\"\n                >\n                  {t('general:filters')}\n                </Pill>\n              )}\n              {enableSort && (\n                <Pill\n                  aria-controls={`${baseClass}-sort`}\n                  aria-expanded={visibleDrawer === 'sort'}\n                  className={`${baseClass}__toggle-sort`}\n                  icon={<ChevronIcon />}\n                  onClick={() => setVisibleDrawer(visibleDrawer !== 'sort' ? 'sort' : undefined)}\n                  pillStyle=\"light\"\n                  size=\"small\"\n                >\n                  {t('general:sort')}\n                </Pill>\n              )}\n              {!disableQueryPresets && (\n                <ActiveQueryPreset\n                  activePreset={activePreset}\n                  openPresetListDrawer={openPresetListDrawer}\n                  resetPreset={resetPreset}\n                />\n              )}\n              {listMenuItems && Array.isArray(listMenuItems) && listMenuItems.length > 0 && (\n                <Popup\n                  button={<Dots ariaLabel={t('general:moreOptions')} />}\n                  className={`${baseClass}__popup`}\n                  horizontalAlign=\"right\"\n                  id=\"list-menu\"\n                  size=\"medium\"\n                  verticalAlign=\"bottom\"\n                >\n                  {listMenuItems.map((item, i) => (\n                    <Fragment key={`list-menu-item-${i}`}>{item}</Fragment>\n                  ))}\n                </Popup>\n              )}\n            </div>\n          </div>\n        </div>\n        {enableColumns && (\n          <AnimateHeight\n            className={`${baseClass}__columns`}\n            height={visibleDrawer === 'columns' ? 'auto' : 0}\n            id={`${baseClass}-columns`}\n          >\n            <ColumnSelector collectionSlug={collectionConfig.slug} />\n          </AnimateHeight>\n        )}\n        <AnimateHeight\n          className={`${baseClass}__where`}\n          height={visibleDrawer === 'where' ? 'auto' : 0}\n          id={`${baseClass}-where`}\n        >\n          <WhereBuilder\n            collectionPluralLabel={collectionConfig?.labels?.plural}\n            collectionSlug={collectionConfig.slug}\n            fields={collectionConfig?.fields}\n            renderedFilters={renderedFilters}\n            resolvedFilterOptions={resolvedFilterOptions}\n          />\n        </AnimateHeight>\n      </div>\n      {PresetListDrawer}\n      {EditPresetDrawer}\n      {CreateNewPresetDrawer}\n      {DeletePresetModal}\n    </Fragment>\n  )\n}\n"],"mappings":"AAAA;;;AAEA,SAASA,aAAa,QAAQ;AAC9B,SAASC,cAAc,QAAQ;AAC/B,SAASC,kBAAkB,QAAQ;AACnC,OAAOC,KAAA,IAASC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ;AAI7D,SAASC,KAAK,EAAEC,SAAS,QAAQ;AACjC,SAASC,gBAAgB,QAAQ;AACjC,SAASC,WAAW,QAAQ;AAC5B,SAASC,IAAI,QAAQ;AACrB,SAASC,UAAU,QAAQ;AAC3B,SAASC,YAAY,QAAQ;AAC7B,SAASC,cAAc,QAAQ;AAC/B,SAASC,aAAa,QAAQ;AAC9B,SAASC,cAAc,QAAQ;AAC/B,SAASC,IAAI,QAAQ;AACrB,SAASC,YAAY,QAAQ;AAC7B,SAASC,YAAY,QAAQ;AAC7B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,yBAAyB,QAAQ;AAC1C,SAASC,eAAe,QAAQ;AAChC,OAAO;AAEP,MAAMC,SAAA,GAAY;AAElB;;;;;AAKA,OAAO,MAAMC,YAAA,GAA6CC,KAAA;EACxD,MAAM;IACJC,aAAa;IACbC,gBAAgB;IAChBC,cAAc;IACdC,mBAAmB;IACnBC,aAAA,GAAgB,IAAI;IACpBC,aAAA,GAAgB,IAAI;IACpBC,UAAA,GAAa,KAAK;IAClBC,aAAA,EAAeC,sBAAsB;IACrCC,WAAA,EAAaC,YAAY;IACzBC,sBAAsB;IACtBC,eAAe;IACfC;EAAqB,CACtB,GAAGd,KAAA;EAEJ,MAAM;IAAEe,kBAAkB;IAAEC;EAAK,CAAE,GAAG5B,YAAA;EAEtC,MAAM;IACJ6B,qBAAqB;IACrBC,iBAAiB;IACjBC,gBAAgB;IAChBC,iBAAiB;IACjBC,oBAAoB;IACpBC,gBAAgB;IAChBC,oBAAoB;IACpBC;EAAW,CACZ,GAAG3B,eAAA,CAAgB;IAClBc,YAAA;IACAR,cAAA;IACAS;EACF;EAEA,MAAMa,UAAA,GAAazC,gBAAA,CAAiBkB,gBAAA;EACpC,MAAM;IAAEwB,IAAI;IAAEC;EAAC,CAAE,GAAGtC,cAAA;EAEpB,MAAM;IACJuC,WAAA,EAAa;MAAEC,CAAA,EAAGC;IAAU;EAAE,CAC/B,GAAGxD,aAAA;EAEJ,MAAMyD,WAAA,GACJ,CAACN,UAAA,IACClD,cAAA,CACE,WAAWkD,UAAA,KACR,OAAOA,UAAA,CAAWO,KAAK,KAAK,YAAY,OAAOP,UAAA,CAAWO,KAAK,KAAK,QAAO,IAC1EP,UAAA,CAAWO,KAAK,GAChB,UAAUP,UAAA,GACRA,UAAA,CAAWQ,IAAI,GACf,MACNP,IAAA,CACF,KACF;EAEF,MAAMQ,oBAAA,GAAuBtC,yBAAA,CAC3BM,gBAAA,CAAiBiC,KAAK,CAACD,oBAAoB,EAC3ChC,gBAAA,CAAiBkC,MAAM,EACvBV,IAAA;EAGF,MAAMW,qBAAA,GAAwBzD,MAAA,CAC5B+C,CAAA,CAAE,oBAAoB;IAAEK,KAAA,EAAOzD,cAAA,CAAewD,WAAA,EAAaL,IAAA;EAAM;EAGnE,MAAMY,aAAA,GAAgB1D,MAAA,CAAO2D,OAAA,CAAQvB,KAAA,EAAOwB,KAAA;EAE5C,MAAMC,2BAAA,GAA8BjE,kBAAA,CAAmBwC,KAAA,EAAOwB,KAAA;EAC9D,MAAM,CAACE,aAAA,EAAeC,gBAAA,CAAiB,GAAG9D,QAAA,CACxC4D,2BAAA,GAA8B,UAAUG,SAAA;EAG1CjE,SAAA,CAAU;IACR,IAAI2D,aAAA,CAAcO,OAAO,IAAI,CAAC7B,KAAA,EAAOwB,KAAA,EAAO;MAC1CF,aAAA,CAAcO,OAAO,GAAG;IAC1B,OAAO,IAAI7B,KAAA,EAAOwB,KAAA,EAAO;MACvBF,aAAA,CAAcO,OAAO,GAAG;IAC1B;EACF,GAAG,CAACF,gBAAA,EAAkB3B,KAAA,EAAOwB,KAAA,CAAM;EAEnC7D,SAAA,CAAU;IACR,IAAIuD,oBAAA,EAAsBY,MAAA,GAAS,GAAG;MACpCT,qBAAA,CAAsBQ,OAAO,GAAGX,oBAAA,CAAqBa,MAAM,CACzD,CAACC,eAAA,EAAyBC,KAAA,EAAOC,CAAA;QAC/B,MAAMlB,KAAA,GACJ,WAAWiB,KAAA,IAASA,KAAA,CAAMjB,KAAK,GAAGiB,KAAA,CAAMjB,KAAK,GAAG,UAAUiB,KAAA,GAAQA,KAAA,CAAMhB,IAAI,GAAG;QAEjF,IAAIiB,CAAA,KAAM,GAAG;UACX,OAAO,GAAGvB,CAAA,CAAE,oBAAoB;YAC9BK,KAAA,EAAOzD,cAAA,CAAeyD,KAAA,EAAON,IAAA;UAC/B,IAAI;QACN;QAEA,IAAIwB,CAAA,KAAMhB,oBAAA,CAAqBY,MAAM,GAAG,GAAG;UACzC,OAAO,GAAGE,eAAA,IAAmBrB,CAAA,CAAE,iBAAiBpD,cAAA,CAAeyD,KAAA,EAAON,IAAA,GAAO;QAC/E;QAEA,OAAO,GAAGsB,eAAA,KAAoBzE,cAAA,CAAeyD,KAAA,EAAON,IAAA,GAAO;MAC7D,GACA;IAEJ,OAAO;MACLW,qBAAA,CAAsBQ,OAAO,GAAGlB,CAAA,CAAE,oBAAoB;QACpDK,KAAA,EAAOzD,cAAA,CAAewD,WAAA,EAAaL,IAAA;MACrC;IACF;EACF,GAAG,CAACC,CAAA,EAAGO,oBAAA,EAAsBR,IAAA,EAAMK,WAAA,CAAY;EAE/C,IAAIvB,aAAA,GAAmCC,sBAAA;EAEvC,IACEP,gBAAA,EAAkBiD,kBAAA,IAClB,CAAC/C,mBAAA,IACDmB,oBAAA,EAAsBuB,MAAA,GAAS,GAC/B;IACA;IACAtC,aAAA,GAAgB,C,GACXe,oBAAA,EACHd,sBAAA,EAAwBqC,MAAA,GAAS,iBAAIM,IAAA,CAACrE,SAAA,CAAUsE,OAAO,MAAK,aAAe,M,IACvE5C,sBAAA,IAA0B,EAAE,EACjC;EACH;EAEA,oBACE6C,KAAA,CAAC5E,QAAA;4BACC4E,KAAA,CAAC;MAAIC,SAAA,EAAWzD,SAAA;8BACdwD,KAAA,CAAC;QAAIC,SAAA,EAAW,GAAGzD,SAAA,QAAiB;gCAClCsD,IAAA,CAACjE,UAAA,O,aACDiE,IAAA,CAAC3D,YAAA;UACC+D,YAAA,EAAczC,kBAAA;UAEd;UACAiB,KAAA,EAAOK,qBAAA,CAAsBQ,OAAO;UACpCY,gBAAA,EAAkBzC,KAAA,EAAO0C;WAHpBvD,cAAA,GAKNQ,YAAA,IAAgBS,iBAAA,gBACfgC,IAAA,CAAC;UAAIG,SAAA,EAAW,GAAGzD,SAAA,YAAqB;oBAAE;aACxC,M,aACJsD,IAAA,CAAC;UAAIG,SAAA,EAAW,GAAGzD,SAAA,WAAoB;oBACrC,aAAAwD,KAAA,CAAC;YAAIC,SAAA,EAAW,GAAGzD,SAAA,gBAAyB;uBACzC,CAACgC,UAAA,iBAAcsB,IAAA,CAAC3E,KAAA,CAAMC,QAAQ;wBAAEuB,aAAA,IAAiBA;gBACjDI,aAAA,iBACC+C,IAAA,CAAC5D,IAAA;cACC,iBAAe,GAAGM,SAAA,UAAmB;cACrC,iBAAe4C,aAAA,KAAkB;cACjCa,SAAA,EAAW,GAAGzD,SAAA,kBAA2B;cACzC6D,IAAA,eAAMP,IAAA,CAACnE,WAAA;gBAAY2E,SAAA,EAAWlB,aAAA,KAAkB,YAAY,OAAO;;cACnEmB,OAAA,EAASA,CAAA,KACPlB,gBAAA,CAAiBD,aAAA,KAAkB,YAAY,YAAYE,SAAA;cAE7DkB,SAAA,EAAU;cACVC,IAAA,EAAK;wBAEJpC,CAAA,CAAE;gBAGNrB,aAAA,iBACC8C,IAAA,CAAC5D,IAAA;cACC,iBAAe,GAAGM,SAAA,QAAiB;cACnC,iBAAe4C,aAAA,KAAkB;cACjCa,SAAA,EAAW,GAAGzD,SAAA,gBAAyB;cACvC6D,IAAA,eAAMP,IAAA,CAACnE,WAAA;gBAAY2E,SAAA,EAAWlB,aAAA,KAAkB,UAAU,OAAO;;cACjEmB,OAAA,EAASA,CAAA,KAAMlB,gBAAA,CAAiBD,aAAA,KAAkB,UAAU,UAAUE,SAAA;cACtEkB,SAAA,EAAU;cACVC,IAAA,EAAK;wBAEJpC,CAAA,CAAE;gBAGNpB,UAAA,iBACC6C,IAAA,CAAC5D,IAAA;cACC,iBAAe,GAAGM,SAAA,OAAgB;cAClC,iBAAe4C,aAAA,KAAkB;cACjCa,SAAA,EAAW,GAAGzD,SAAA,eAAwB;cACtC6D,IAAA,eAAMP,IAAA,CAACnE,WAAA;cACP4E,OAAA,EAASA,CAAA,KAAMlB,gBAAA,CAAiBD,aAAA,KAAkB,SAAS,SAASE,SAAA;cACpEkB,SAAA,EAAU;cACVC,IAAA,EAAK;wBAEJpC,CAAA,CAAE;gBAGN,CAACvB,mBAAA,iBACAgD,IAAA,CAACzD,iBAAA;cACCgB,YAAA,EAAcA,YAAA;cACdU,oBAAA,EAAsBA,oBAAA;cACtBG,WAAA,EAAaA;gBAGhBhB,aAAA,IAAiBwD,KAAA,CAAMC,OAAO,CAACzD,aAAA,KAAkBA,aAAA,CAAcsC,MAAM,GAAG,kBACvEM,IAAA,CAACtE,KAAA;cACCoF,MAAA,eAAQd,IAAA,CAAClE,IAAA;gBAAKiF,SAAA,EAAWxC,CAAA,CAAE;;cAC3B4B,SAAA,EAAW,GAAGzD,SAAA,SAAkB;cAChCsE,eAAA,EAAgB;cAChBC,EAAA,EAAG;cACHN,IAAA,EAAK;cACLO,aAAA,EAAc;wBAEb9D,aAAA,CAAc+D,GAAG,CAAC,CAACC,IAAA,EAAMtB,GAAA,kBACxBE,IAAA,CAAC1E,QAAA;0BAAsC8F;iBAAxB,kBAAkBtB,GAAA,EAAG;;;;UAO/C7C,aAAA,iBACC+C,IAAA,CAAC9D,aAAA;QACCiE,SAAA,EAAW,GAAGzD,SAAA,WAAoB;QAClC2E,MAAA,EAAQ/B,aAAA,KAAkB,YAAY,SAAS;QAC/C2B,EAAA,EAAI,GAAGvE,SAAA,UAAmB;kBAE1B,aAAAsD,IAAA,CAAC7D,cAAA;UAAeY,cAAA,EAAgBD,gBAAA,CAAiBwE;;uBAGrDtB,IAAA,CAAC9D,aAAA;QACCiE,SAAA,EAAW,GAAGzD,SAAA,SAAkB;QAChC2E,MAAA,EAAQ/B,aAAA,KAAkB,UAAU,SAAS;QAC7C2B,EAAA,EAAI,GAAGvE,SAAA,QAAiB;kBAExB,aAAAsD,IAAA,CAAC1D,YAAA;UACCiF,qBAAA,EAAuBzE,gBAAA,EAAkB0E,MAAA,EAAQC,MAAA;UACjD1E,cAAA,EAAgBD,gBAAA,CAAiBwE,IAAI;UACrCtC,MAAA,EAAQlC,gBAAA,EAAkBkC,MAAA;UAC1BvB,eAAA,EAAiBA,eAAA;UACjBC,qBAAA,EAAuBA;;;QAI5BQ,gBAAA,EACAH,gBAAA,EACAF,qBAAA,EACAC,iBAAA;;AAGP","ignoreList":[]}