{"version":3,"sources":["../../src/utilities/getIncomingFiles.ts"],"sourcesContent":["import type { FileData, PayloadRequest } from 'payload'\n\nimport type { File } from '../types.js'\n\nexport function getIncomingFiles({\n  data,\n  req,\n}: {\n  data: Partial<FileData>\n  req: PayloadRequest\n}): File[] {\n  const file = req.file\n\n  let files: File[] = []\n\n  if (file && data.filename && data.mimeType) {\n    const mainFile: File = {\n      buffer: file.data,\n      filename: data.filename,\n      filesize: file.size,\n      mimeType: data.mimeType,\n      tempFilePath: file.tempFilePath,\n    }\n\n    files = [mainFile]\n\n    if (data?.sizes) {\n      Object.entries(data.sizes).forEach(([key, resizedFileData]) => {\n        if (req.payloadUploadSizes?.[key] && data.mimeType) {\n          files = files.concat([\n            {\n              buffer: req.payloadUploadSizes[key],\n              filename: `${resizedFileData.filename}`,\n              filesize: req.payloadUploadSizes[key].length,\n              mimeType: data.mimeType,\n            },\n          ])\n        }\n      })\n    }\n  }\n\n  return files\n}\n"],"names":["getIncomingFiles","data","req","file","files","filename","mimeType","mainFile","buffer","filesize","size","tempFilePath","sizes","Object","entries","forEach","key","resizedFileData","payloadUploadSizes","concat","length"],"mappings":"AAIA,OAAO,SAASA,iBAAiB,EAC/BC,IAAI,EACJC,GAAG,EAIJ;IACC,MAAMC,OAAOD,IAAIC,IAAI;IAErB,IAAIC,QAAgB,EAAE;IAEtB,IAAID,QAAQF,KAAKI,QAAQ,IAAIJ,KAAKK,QAAQ,EAAE;QAC1C,MAAMC,WAAiB;YACrBC,QAAQL,KAAKF,IAAI;YACjBI,UAAUJ,KAAKI,QAAQ;YACvBI,UAAUN,KAAKO,IAAI;YACnBJ,UAAUL,KAAKK,QAAQ;YACvBK,cAAcR,KAAKQ,YAAY;QACjC;QAEAP,QAAQ;YAACG;SAAS;QAElB,IAAIN,MAAMW,OAAO;YACfC,OAAOC,OAAO,CAACb,KAAKW,KAAK,EAAEG,OAAO,CAAC,CAAC,CAACC,KAAKC,gBAAgB;gBACxD,IAAIf,IAAIgB,kBAAkB,EAAE,CAACF,IAAI,IAAIf,KAAKK,QAAQ,EAAE;oBAClDF,QAAQA,MAAMe,MAAM,CAAC;wBACnB;4BACEX,QAAQN,IAAIgB,kBAAkB,CAACF,IAAI;4BACnCX,UAAU,GAAGY,gBAAgBZ,QAAQ,EAAE;4BACvCI,UAAUP,IAAIgB,kBAAkB,CAACF,IAAI,CAACI,MAAM;4BAC5Cd,UAAUL,KAAKK,QAAQ;wBACzB;qBACD;gBACH;YACF;QACF;IACF;IAEA,OAAOF;AACT"}