{"version":3,"sources":["../../src/models/buildGlobalModel.ts"],"sourcesContent":["import type { Payload } from 'payload'\n\nimport mongoose from 'mongoose'\n\nimport type { GlobalModel } from '../types.js'\n\nimport { getBuildQueryPlugin } from '../queries/getBuildQueryPlugin.js'\nimport { buildSchema } from './buildSchema.js'\n\nexport const buildGlobalModel = (payload: Payload): GlobalModel | null => {\n  if (payload.config.globals && payload.config.globals.length > 0) {\n    const globalsSchema = new mongoose.Schema(\n      {},\n      { discriminatorKey: 'globalType', minimize: false, timestamps: true },\n    )\n\n    globalsSchema.plugin(getBuildQueryPlugin())\n\n    const Globals = mongoose.model('globals', globalsSchema, 'globals') as unknown as GlobalModel\n\n    Object.values(payload.config.globals).forEach((globalConfig) => {\n      const globalSchema = buildSchema({\n        buildSchemaOptions: {\n          options: {\n            minimize: false,\n          },\n        },\n        configFields: globalConfig.fields,\n        payload,\n      })\n      Globals.discriminator(globalConfig.slug, globalSchema)\n    })\n\n    return Globals\n  }\n\n  return null\n}\n"],"names":["mongoose","getBuildQueryPlugin","buildSchema","buildGlobalModel","payload","config","globals","length","globalsSchema","Schema","discriminatorKey","minimize","timestamps","plugin","Globals","model","Object","values","forEach","globalConfig","globalSchema","buildSchemaOptions","options","configFields","fields","discriminator","slug"],"mappings":"AAEA,OAAOA,cAAc,WAAU;AAI/B,SAASC,mBAAmB,QAAQ,oCAAmC;AACvE,SAASC,WAAW,QAAQ,mBAAkB;AAE9C,OAAO,MAAMC,mBAAmB,CAACC;IAC/B,IAAIA,QAAQC,MAAM,CAACC,OAAO,IAAIF,QAAQC,MAAM,CAACC,OAAO,CAACC,MAAM,GAAG,GAAG;QAC/D,MAAMC,gBAAgB,IAAIR,SAASS,MAAM,CACvC,CAAC,GACD;YAAEC,kBAAkB;YAAcC,UAAU;YAAOC,YAAY;QAAK;QAGtEJ,cAAcK,MAAM,CAACZ;QAErB,MAAMa,UAAUd,SAASe,KAAK,CAAC,WAAWP,eAAe;QAEzDQ,OAAOC,MAAM,CAACb,QAAQC,MAAM,CAACC,OAAO,EAAEY,OAAO,CAAC,CAACC;YAC7C,MAAMC,eAAelB,YAAY;gBAC/BmB,oBAAoB;oBAClBC,SAAS;wBACPX,UAAU;oBACZ;gBACF;gBACAY,cAAcJ,aAAaK,MAAM;gBACjCpB;YACF;YACAU,QAAQW,aAAa,CAACN,aAAaO,IAAI,EAAEN;QAC3C;QAEA,OAAON;IACT;IAEA,OAAO;AACT,EAAC"}