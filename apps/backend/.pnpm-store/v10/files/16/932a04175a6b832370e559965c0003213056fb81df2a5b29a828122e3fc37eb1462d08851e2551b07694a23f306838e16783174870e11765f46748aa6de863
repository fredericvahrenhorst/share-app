{"version":3,"sources":["../../src/utilities/getStorageClient.ts"],"sourcesContent":["import type * as AWS from '@aws-sdk/client-s3'\nimport type { CognitoUserSession } from 'amazon-cognito-identity-js'\n\nimport type { GetStorageClient } from './refreshSession.js'\n\nimport { refreshSession } from './refreshSession.js'\n\nexport let storageClient: AWS.S3 | null = null\nexport let session: CognitoUserSession | null = null\nexport let identityID: string\n\nexport const getStorageClient: GetStorageClient = async () => {\n  if (storageClient && session?.isValid()) {\n    return {\n      identityID,\n      storageClient,\n    }\n  }\n\n  ;({ identityID, session, storageClient } = await refreshSession())\n\n  if (!process.env.PAYLOAD_CLOUD_PROJECT_ID) {\n    throw new Error('PAYLOAD_CLOUD_PROJECT_ID is required')\n  }\n  if (!process.env.PAYLOAD_CLOUD_COGNITO_PASSWORD) {\n    throw new Error('PAYLOAD_CLOUD_COGNITO_PASSWORD is required')\n  }\n  if (!process.env.PAYLOAD_CLOUD_COGNITO_IDENTITY_POOL_ID) {\n    throw new Error('PAYLOAD_CLOUD_COGNITO_IDENTITY_POOL_ID is required')\n  }\n\n  return {\n    identityID,\n    storageClient,\n  }\n}\n"],"names":["refreshSession","storageClient","session","identityID","getStorageClient","isValid","process","env","PAYLOAD_CLOUD_PROJECT_ID","Error","PAYLOAD_CLOUD_COGNITO_PASSWORD","PAYLOAD_CLOUD_COGNITO_IDENTITY_POOL_ID"],"mappings":"AAKA,SAASA,cAAc,QAAQ,sBAAqB;AAEpD,OAAO,IAAIC,gBAA+B,KAAI;AAC9C,OAAO,IAAIC,UAAqC,KAAI;AACpD,OAAO,IAAIC,WAAkB;AAE7B,OAAO,MAAMC,mBAAqC;IAChD,IAAIH,iBAAiBC,SAASG,WAAW;QACvC,OAAO;YACLF;YACAF;QACF;IACF;;IAEE,CAAA,EAAEE,UAAU,EAAED,OAAO,EAAED,aAAa,EAAE,GAAG,MAAMD,gBAAe;IAEhE,IAAI,CAACM,QAAQC,GAAG,CAACC,wBAAwB,EAAE;QACzC,MAAM,IAAIC,MAAM;IAClB;IACA,IAAI,CAACH,QAAQC,GAAG,CAACG,8BAA8B,EAAE;QAC/C,MAAM,IAAID,MAAM;IAClB;IACA,IAAI,CAACH,QAAQC,GAAG,CAACI,sCAAsC,EAAE;QACvD,MAAM,IAAIF,MAAM;IAClB;IAEA,OAAO;QACLN;QACAF;IACF;AACF,EAAC"}