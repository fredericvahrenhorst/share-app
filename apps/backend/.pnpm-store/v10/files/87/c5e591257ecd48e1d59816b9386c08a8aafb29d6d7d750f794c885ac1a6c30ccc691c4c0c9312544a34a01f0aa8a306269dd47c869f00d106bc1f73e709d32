{"version":3,"file":"fieldReducer.js","names":["ObjectIdImport","dequal","deepCopyObjectSimpleWithoutReactComponents","mergeServerFormState","flattenRows","separateRows","ObjectId","default","fieldReducer","state","action","type","blockType","path","rowIndex","rowIndexFromArgs","subFieldState","rows","length","withNewRow","newRow","id","value","toHexString","isLoading","splice","initialValue","valid","remainingFields","siblingRows","newState","passesCondition","disableFormData","errorPaths","errors","forEach","message","fieldPath","errorMessage","segments","split","push","fieldErrorPath","parentPath","slice","join","Object","entries","reduce","acc","fieldState","fieldErrorPaths","errorACC","startsWith","changed","newErrorPaths","Array","isArray","includes","rowsMetadata","duplicateRowMetadata","customComponents","RowLabel","duplicateRowState","key","keys","filter","endsWith","idState","isValid","acceptValues","prevStateRef","serverState","currentState","incomingState","current","moveFromIndex","moveToIndex","topLevelRows","copyOfMovingRow","rowsWithinField","copyOfMovingRow2","rowIndexArg","Math","max","min","undefined","collapsed","optimize","newField","oldField","sanitize","field","values","updatedRows","formState"],"sources":["../../../src/forms/Form/fieldReducer.ts"],"sourcesContent":["'use client'\nimport type { FormField, FormState, Row } from 'payload'\n\nimport ObjectIdImport from 'bson-objectid'\nimport { dequal } from 'dequal/lite' // lite: no need for Map and Set support\nimport { deepCopyObjectSimpleWithoutReactComponents } from 'payload/shared'\n\nimport type { FieldAction } from './types.js'\n\nimport { mergeServerFormState } from './mergeServerFormState.js'\nimport { flattenRows, separateRows } from './rows.js'\n\nconst ObjectId = (ObjectIdImport.default ||\n  ObjectIdImport) as unknown as typeof ObjectIdImport.default\n\n/**\n * Reducer which modifies the form field state (all the current data of the fields in the form). When called using dispatch, it will return a new state object.\n */\nexport function fieldReducer(state: FormState, action: FieldAction): FormState {\n  switch (action.type) {\n    case 'ADD_ROW': {\n      const { blockType, path, rowIndex: rowIndexFromArgs, subFieldState = {} } = action\n\n      const rowIndex =\n        typeof rowIndexFromArgs === 'number' ? rowIndexFromArgs : state[path]?.rows?.length || 0\n\n      const withNewRow = [...(state[path]?.rows || [])]\n\n      const newRow: Row = {\n        id: (subFieldState?.id?.value as string) || new ObjectId().toHexString(),\n        isLoading: true,\n      }\n\n      if (blockType) {\n        newRow.blockType = blockType\n      }\n\n      withNewRow.splice(rowIndex, 0, newRow)\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // add new row to array _field state_\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n\n      siblingRows.splice(rowIndex, 0, subFieldState)\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [`${path}.${rowIndex}.id`]: {\n          initialValue: newRow.id,\n          passesCondition: true,\n          valid: true,\n          value: newRow.id,\n        },\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: withNewRow,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'ADD_SERVER_ERRORS': {\n      let newState = { ...state }\n\n      const errorPaths: { fieldErrorPath: string; parentPath: string }[] = []\n\n      action.errors.forEach(({ message, path: fieldPath }) => {\n        newState[fieldPath] = {\n          ...(newState[fieldPath] || {\n            initialValue: null,\n            value: null,\n          }),\n          errorMessage: message,\n          valid: false,\n        }\n\n        const segments = fieldPath.split('.')\n        if (segments.length > 1) {\n          errorPaths.push({\n            fieldErrorPath: fieldPath,\n            parentPath: segments.slice(0, segments.length - 1).join('.'),\n          })\n        }\n      })\n\n      newState = Object.entries(newState).reduce((acc, [path, fieldState]) => {\n        const fieldErrorPaths = errorPaths.reduce((errorACC, { fieldErrorPath, parentPath }) => {\n          if (parentPath.startsWith(path)) {\n            errorACC.push(fieldErrorPath)\n          }\n          return errorACC\n        }, [])\n\n        let changed = false\n\n        if (fieldErrorPaths.length > 0) {\n          const newErrorPaths = Array.isArray(fieldState.errorPaths) ? fieldState.errorPaths : []\n\n          fieldErrorPaths.forEach((fieldErrorPath) => {\n            if (!newErrorPaths.includes(fieldErrorPath)) {\n              newErrorPaths.push(fieldErrorPath)\n              changed = true\n            }\n          })\n\n          if (changed) {\n            acc[path] = {\n              ...fieldState,\n              errorPaths: newErrorPaths,\n            }\n          }\n        }\n\n        if (!changed) {\n          acc[path] = fieldState\n        }\n\n        return acc\n      }, {})\n\n      return newState\n    }\n\n    case 'DUPLICATE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path].rows || [])]\n\n      const duplicateRowMetadata = deepCopyObjectSimpleWithoutReactComponents(\n        rowsMetadata[rowIndex],\n      )\n\n      if (duplicateRowMetadata.id) {\n        duplicateRowMetadata.id = new ObjectId().toHexString()\n      }\n\n      if (rowsMetadata[rowIndex]?.customComponents?.RowLabel) {\n        duplicateRowMetadata.customComponents = {\n          RowLabel: rowsMetadata[rowIndex].customComponents.RowLabel,\n        }\n      }\n\n      const duplicateRowState = deepCopyObjectSimpleWithoutReactComponents(rows[rowIndex])\n\n      if (duplicateRowState.id) {\n        duplicateRowState.id.value = new ObjectId().toHexString()\n        duplicateRowState.id.initialValue = new ObjectId().toHexString()\n      }\n\n      for (const key of Object.keys(duplicateRowState).filter((key) => key.endsWith('.id'))) {\n        const idState = duplicateRowState[key]\n\n        if (idState && typeof idState.value === 'string' && ObjectId.isValid(idState.value)) {\n          duplicateRowState[key].value = new ObjectId().toHexString()\n          duplicateRowState[key].initialValue = new ObjectId().toHexString()\n        }\n      }\n\n      // If there are subfields\n      if (Object.keys(duplicateRowState).length > 0) {\n        // Add new object containing subfield names to unflattenedRows array\n        rows.splice(rowIndex + 1, 0, duplicateRowState)\n        rowsMetadata.splice(rowIndex + 1, 0, duplicateRowMetadata)\n      }\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, rows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'MERGE_SERVER_STATE': {\n      const { acceptValues, prevStateRef, serverState } = action\n\n      const newState = mergeServerFormState({\n        acceptValues,\n        currentState: state || {},\n        incomingState: serverState,\n      })\n\n      prevStateRef.current = newState\n\n      return newState\n    }\n\n    case 'MOVE_ROW': {\n      const { moveFromIndex, moveToIndex, path } = action\n\n      // Handle moving rows on the top-level, i.e. `array.0.text` -> `array.1.text`\n      const { remainingFields, rows: topLevelRows } = separateRows(path, state)\n      const copyOfMovingRow = topLevelRows[moveFromIndex]\n      topLevelRows.splice(moveFromIndex, 1)\n      topLevelRows.splice(moveToIndex, 0, copyOfMovingRow)\n\n      // modify array/block internal row state (i.e. collapsed, blockType)\n      const rowsWithinField = [...(state[path]?.rows || [])]\n      const copyOfMovingRow2 = { ...rowsWithinField[moveFromIndex] }\n      rowsWithinField.splice(moveFromIndex, 1)\n      rowsWithinField.splice(moveToIndex, 0, copyOfMovingRow2)\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, topLevelRows),\n        [path]: {\n          ...state[path],\n          rows: rowsWithinField,\n        },\n      }\n\n      return newState\n    }\n\n    case 'REMOVE': {\n      const newState = { ...state }\n      if (newState[action.path]) {\n        delete newState[action.path]\n      }\n      return newState\n    }\n\n    case 'REMOVE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path]?.rows || [])]\n\n      rows.splice(rowIndex, 1)\n      rowsMetadata.splice(rowIndex, 1)\n\n      const newState: FormState = {\n        ...remainingFields,\n        [path]: {\n          ...state[path],\n          disableFormData: rows.length > 0,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n        ...flattenRows(path, rows),\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_ROW': {\n      const { blockType, path, rowIndex: rowIndexArg, subFieldState = {} } = action\n\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n      const rowIndex = Math.max(0, Math.min(rowIndexArg, siblingRows?.length - 1 || 0))\n\n      const rowsMetadata = [...(state[path]?.rows || [])]\n      rowsMetadata[rowIndex] = {\n        id: new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n      }\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // replace form _field state_\n      siblingRows[rowIndex] = subFieldState\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_STATE': {\n      if (action.optimize !== false) {\n        // Only update fields that have changed\n        // by comparing old value / initialValue to new\n        // ..\n        // This is a performance enhancement for saving\n        // large documents with hundreds of fields\n        const newState: FormState = {}\n\n        for (const [path, newField] of Object.entries(action.state)) {\n          const oldField = state[path]\n\n          if (newField.valid !== false) {\n            newField.valid = true\n          }\n          if (newField.passesCondition !== false) {\n            newField.passesCondition = true\n          }\n\n          if (!dequal(oldField, newField)) {\n            newState[path] = newField\n          } else if (oldField) {\n            newState[path] = oldField\n          }\n        }\n\n        return newState\n      }\n\n      // TODO: Remove this in 4.0 - this is a temporary fix to prevent a breaking change\n      if (action.sanitize) {\n        for (const field of Object.values(action.state)) {\n          if (field.valid !== false) {\n            field.valid = true\n          }\n          if (field.passesCondition !== false) {\n            field.passesCondition = true\n          }\n        }\n      }\n      // If we're not optimizing, just set the state to the new state\n      return action.state\n    }\n\n    case 'SET_ALL_ROWS_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      return {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n    }\n\n    case 'SET_ROW_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      const newState = {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n\n      return newState\n    }\n\n    case 'UPDATE': {\n      const newField = Object.entries(action).reduce(\n        (field, [key, value]) => {\n          if (\n            [\n              'disableFormData',\n              'errorMessage',\n              'initialValue',\n              'rows',\n              'valid',\n              'validate',\n              'value',\n            ].includes(key)\n          ) {\n            return {\n              ...field,\n              [key]: value,\n            }\n          }\n\n          return field\n        },\n        state?.[action.path] || ({} as FormField),\n      )\n\n      const newState = {\n        ...state,\n        [action.path]: newField,\n      }\n\n      return newState\n    }\n\n    case 'UPDATE_MANY': {\n      const newState = { ...state }\n\n      Object.entries(action.formState).forEach(([path, field]) => {\n        newState[path] = field\n      })\n\n      return newState\n    }\n\n    default: {\n      return state\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}