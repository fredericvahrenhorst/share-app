{"version":3,"sources":["../../src/utilities/authAsCognitoUser.ts"],"sourcesContent":["import type { CognitoUserSession } from 'amazon-cognito-identity-js'\n\nimport { AuthenticationDetails, CognitoUser, CognitoUserPool } from 'amazon-cognito-identity-js'\n\nlet sessionAndToken: CognitoUserSession | null = null\n\nexport const authAsCognitoUser = async (\n  username: string,\n  password: string,\n): Promise<CognitoUserSession> => {\n  // TODO: Check that isValid evaluates expiration\n  if (sessionAndToken?.isValid()) {\n    return sessionAndToken\n  }\n\n  if (!process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID) {\n    throw new Error('PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID is required')\n  }\n  if (!process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_ID) {\n    throw new Error('PAYLOAD_CLOUD_COGNITO_USER_POOL_ID is required')\n  }\n\n  const userPool = new CognitoUserPool({\n    ClientId: process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID,\n    UserPoolId: process.env.PAYLOAD_CLOUD_COGNITO_USER_POOL_ID,\n  })\n\n  const authenticationDetails = new AuthenticationDetails({\n    Password: password,\n    Username: username,\n  })\n\n  const cognitoUser = new CognitoUser({\n    Pool: userPool,\n    Username: username,\n  })\n\n  const result: CognitoUserSession = await new Promise((resolve, reject) => {\n    cognitoUser.authenticateUser(authenticationDetails, {\n      onFailure: (err: Error) => {\n        reject(err)\n      },\n      onSuccess: (res) => {\n        resolve(res)\n      },\n    })\n  })\n\n  sessionAndToken = result\n\n  return sessionAndToken\n}\n"],"names":["AuthenticationDetails","CognitoUser","CognitoUserPool","sessionAndToken","authAsCognitoUser","username","password","isValid","process","env","PAYLOAD_CLOUD_COGNITO_USER_POOL_CLIENT_ID","Error","PAYLOAD_CLOUD_COGNITO_USER_POOL_ID","userPool","ClientId","UserPoolId","authenticationDetails","Password","Username","cognitoUser","Pool","result","Promise","resolve","reject","authenticateUser","onFailure","err","onSuccess","res"],"mappings":"AAEA,SAASA,qBAAqB,EAAEC,WAAW,EAAEC,eAAe,QAAQ,6BAA4B;AAEhG,IAAIC,kBAA6C;AAEjD,OAAO,MAAMC,oBAAoB,OAC/BC,UACAC;IAEA,gDAAgD;IAChD,IAAIH,iBAAiBI,WAAW;QAC9B,OAAOJ;IACT;IAEA,IAAI,CAACK,QAAQC,GAAG,CAACC,yCAAyC,EAAE;QAC1D,MAAM,IAAIC,MAAM;IAClB;IACA,IAAI,CAACH,QAAQC,GAAG,CAACG,kCAAkC,EAAE;QACnD,MAAM,IAAID,MAAM;IAClB;IAEA,MAAME,WAAW,IAAIX,gBAAgB;QACnCY,UAAUN,QAAQC,GAAG,CAACC,yCAAyC;QAC/DK,YAAYP,QAAQC,GAAG,CAACG,kCAAkC;IAC5D;IAEA,MAAMI,wBAAwB,IAAIhB,sBAAsB;QACtDiB,UAAUX;QACVY,UAAUb;IACZ;IAEA,MAAMc,cAAc,IAAIlB,YAAY;QAClCmB,MAAMP;QACNK,UAAUb;IACZ;IAEA,MAAMgB,SAA6B,MAAM,IAAIC,QAAQ,CAACC,SAASC;QAC7DL,YAAYM,gBAAgB,CAACT,uBAAuB;YAClDU,WAAW,CAACC;gBACVH,OAAOG;YACT;YACAC,WAAW,CAACC;gBACVN,QAAQM;YACV;QACF;IACF;IAEA1B,kBAAkBkB;IAElB,OAAOlB;AACT,EAAC"}